function(a){a.fn.bAutoSize=function(c,d){return this.each(function(){var e=a(this);f=e.data("bAutoSize");if(f){if(typeof f[c]=="function"){if(d&&d.length>0)f[c].apply(f,d);else f[c].call(f)}return e.data("bAutoSize")}var f=new b(this,c);e.data("bAutoSize",f)})};var b=function(b,c){var d=a(b);var e=this;var f={w:null,h:null};var g={w:null,h:null};this.locked=false;var h=a.extend({parent:a(d).parent(),trigger_at_load:true,trigger_minimum:20,width_offset:0,height_offset:0,width_perc:1,height_perc:1,minimum:false,maximum:false,height_proportion:false,callback:null,callback_env:null,resize_children:false,debug:false},c||{});this.init=function(){var b=d.width();var c=d.height();g.w=b;g.h=c;if(h.height_proportion===true||h.height_proportion=="auto"){if(b&&c)h.height_proportion=Math.round(c/b*100)/100;else{h.debug?console.log("[bautosize]Cannot calculate height_proportion."):false;h.height_proportion=false}}if(h.trigger_at_load){e.resize(true)}a(window).resize(function(){a(d).bAutoSize("resize")})};this.resize=function(b){if(this.locked){return false}ww=Math.floor(h.parent.width());hh=Math.floor(h.parent.height());if(h.debug){console.log("[bautosize] for #"+d.attr("id"));console.log("[bautosize]parent.w : "+ww+" parent.h : "+hh)}if(!b&&Math.abs(ww-f.w)<h.trigger_minimum&&Math.abs(hh-f.h)<h.trigger_minimum){return false}f.w=ww;f.h=hh;new_width=Math.floor((ww-h.width_offset)*h.width_perc);new_height=Math.floor((hh-h.height_offset)*h.height_perc);if(h.height_proportion>0){h.debug?console.log("enforced proportion h"+h.height_proportion):true;old_height=new_height;new_height=Math.floor(new_width*h.height_proportion);if(new_height>old_height){new_width=Math.floor(new_width*(old_height/new_height));new_height=Math.floor(new_width*h.height_proportion)}}if(h.minimum){if(typeof h.minimum.w!=="undefined"&&new_width<h.minimum.w){h.debug?console.log("[bautosize]enforced minimum w"+h.minimum.w):true;new_width=Math.max(new_width,h.minimum.w)}if(typeof h.minimum.h!=="undefined"&&new_height<h.minimum.h){h.debug?console.log("[bautosize]enforced minimum h"+h.minimum.h):true;new_height=Math.max(new_height,h.minimum.h)}}if(h.maximum){if(typeof h.maximum.w!=="undefined"&&new_width>h.maximum.w){h.debug?console.log("[bautosize]enforced maximum w"+h.maximum.w):true;new_width=Math.min(new_width,h.maximum.w)}if(typeof h.maximum.h!=="undefined"&&new_height>h.maximum.h){h.debug?console.log("[bautosize]enforced maximum h"+h.maximum.h):true;new_height=Math.min(new_height,h.maximum.h)}}d.width(new_width);d.height(new_height);if(h.resize_children){a(d).children().each(function(b,c){a(c)[0].width=new_width;a(c)[0].height=new_height})}if(typeof h.callback=="function")h.callback.call(h.callback_env?h.callback_env:false);if(h.debug)console.log("[bautosize] elem.w : "+new_width+" elem.h : "+new_height);return true};this.lock=function(){this.locked=true;h.debug?console.log("[bautosize]Plugin is now locked."):false;return true};this.unlock=function(){this.locked=false;h.debug?console.log("[bautosize]Plugin is now UNlocked."):false;return true};this.rollback=function(){if(!g.w||!g.h||this.locked)return false;a(d).width(g.w).height(g.h);h.debug?console.log("[bautosize]Rolled back to original size."):false;return true};a(document).ready(this.init)}}