function(e,t,n){"use strict";e.fn.mobileBox=function(r){var i={counter:"{i} of {t}",isTouch:"ontouchstart"in t.documentElement,disableWithMaxWidth:480};e.extend(i,r),e(this).addClass("_mobileBox"),e(this).click(function(t){if(s>i.disableWithMaxWidth||!i.isTouch)return;var n=e(this).attr("href"),r=e(this).attr("title"),o=e(this).attr("class").split(" "),u=new Image;u.src=n;var h=[];for(var p=0;p<o.length;p++){var d=o[p];if(d==="_mobileBox")continue;var v=e("."+d);for(var m=0;m<v.length;m++){var g=v[m];h.indexOf(g)===-1&&h.push(g)}}var y=e(h).index(this);return f(u,function(t,s,o){var u=h.length?h.length:1,f=i.counter.replace("{i}",y+1).replace("{t}",u),p=e(a.replace("{src}",n).replace("{title}",r).replace("{counter}",f));e(".mobileBox",p).append(this),e(".mobileBoxDone a",p).bind("click",l),e("body").prepend(p),c(e(".mobileBox"),h,y)}),!1});var s=e(n).width(),o=e(n).height(),u="landscape",a=['<div class="mobileBoxWrapper">','<div class="mobileBoxBg"></div>','<div class="mobileBox">','<div class="mobileBoxHeader">','<span class="mobileBoxDone"><a href="#done">Done</a></span>','<span class="mobileBoxCounter">{counter}</span>',"</div>",'<div class="mobileBoxTitle">{title}</div>',"</div>","<div>"].join(""),f=function(t,n){e(t).load(function(r){var i=r.currentTarget;i.width<i.height&&(u="portrait");var a=o-i.height;a=a>=0?a/4:0;if(i.width<s){e(t).css({width:i.width+"px"});var f=(s-i.width)/2;e(t).css({"margin-left":f+"px"})}else a+=35;e(t).css({"margin-top":a+"px"}),n.call(t,i.width,i.height,a)})},l=function(){return e(".mobileBoxWrapper").fadeOut(function(){e(this).remove()}),!1},c=function(t,n,r){function c(e){var t=e.originalEvent.targetTouches[0];u.x=t.pageX,u.y=t.pageY}function h(e){var t=e.originalEvent.targetTouches[0];a.x=t.pageX,a.y=t.pageY,e.preventDefault()}function p(){}function d(){var e=u.y-a.y,t,n=l.threshold,r=n.y,s=n.x;e<r&&e>-r&&(t=u.x-a.x,t>s?l.swipeLeft.call(i):t<-s&&l.swipeRight.call(i))}var i=t,o=function(t){if(r+t>=0&&r+t<n.length){var i=r+t,o=e(n[i]);e(".mobileBox img").animate({left:(t<0?"+":"-")+"="+s},200,function(){e(this).remove()});var u=new Image;u.src=o.attr("href"),f(u,function(r,u,a){var f={},l=0;r<s&&(l=(s-r)/2),t>0?(e(this).css({right:"-"+s+"px"}),f.right=l+"px"):(e(this).css({left:"-"+s+"px"}),f.left=l+"px"),e(".mobileBoxTitle").html(o.attr("title")),e(".mobileBoxCounter").html(i+1+" of "+n.length),e(".mobileBox").append(this),e(this).animate(f,200)}),r+=t}},u={x:0,y:0},a={x:0,y:0},l={threshold:{x:3,y:10},swipeLeft:function(){o(1)},swipeRight:function(){o(-1)}};e(i).bind("touchstart.swipe",c).bind("touchmove.swipe",h).bind("touchend.swipe",d).bind("touchcancel.swipe",p)}}}