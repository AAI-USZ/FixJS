function(a){a.fn.thumbnailer=function(b){function d(c,d,e,f){var g=0;var h=e.find(".thumbwrapper ul");var i=e.find(".thumbwrapper").width();var j=a(h).position();var k=a(h).width();if(d){g=j.left+f*b.scrollThumbs;if(g<=0){a(h).animate({left:g},300,function(){if(g==0){c.removeClass("active")}else{c.addClass("active")}});e.find(".rightnavclick").addClass("active")}}else{result=j.left+k-i;if(result>=0){var d=j.left-f*b.scrollThumbs;a(h).animate({left:d},300,function(){if(result-f<0){c.removeClass("active")}else{c.addClass("active")}});e.find(".leftnavclick").addClass("active")}}return false}function e(a,b){var c=a.parent().offset();var d=a.find(".zoomlens");var e=Math.min(Math.max(b.pageY-c.top-d.height()/2,0),a.height()-d.height()-2);var f=Math.min(Math.max(b.pageX-c.left-d.width()/2,0),a.width()-d.width()-2);d.css({top:e,left:f});var g=a.find(".zoomer");var h=g.find("img");var i=a.find("img");var j=h.width();var k=h.height();var l=i.width();var m=i.height();var n=Math.floor(l/j*100);var o=Math.floor(m/k*100);var p=e/n*100;var q=f/o*100;var r=parseInt(i.css("margin-top"));var s=parseInt(i.css("margin-left"));r=r/o*100;s=s/n*100;p=p-r;q=q-s;h.css({top:-p,left:-q})}function f(a){var b=a.width();var c=a.height();var d=a.parent();var e=d.width();var f=d.height();var g=0;var h=0;if(b<e){g=Math.floor((e-b)/2)}if(c<f){h=Math.floor((f-c)/2)}a.css({"margin-left":g+"px","margin-top":h+"px"})}var c={zoom:1,captions:0,scrollThumbs:1,zoomPos:"outside",captionShow:0,zoomIndicator:1,zoomLocation:"right"};var b=a.extend(c,b);return this.each(function(){var c=a(this);var g=0;var h=0;var i=0;var j=0;var k=c.find(".imagethumbs");var l=c.find(".imagethumbs ul li");var m=l.length;if(m>0){var n=m;var o=a("<div/>",{"class":"thumbwrapper"});var p=a("<div/>",{"class":"leftnavclick nav"}).html("<span></span>");var q=a("<div/>",{"class":"rightnavclick nav active"}).html("<span></span>");var r=k.html();o.append(r);var s=c.find(".thumbwrapper ul");l.each(function(b,d){var e=a(this);var l=e.find("img").attr("src");$temp=a("<img/>",{src:l+"?"+(new Date).getTime()}).load(function(){i=Math.max(i,parseFloat(this.width));j=Math.max(j,parseFloat(this.height));c.find(".thumbwrapper a").css({width:i,height:j});g=Math.max(g,i+16);h=Math.max(h,j+16);if(b==m-1){q.css("top",j/2);p.css("top",j/2);var d=g*n;k.html("");if(d>c.width()+20){k.append(o);k.append(p).append(q);o.css("margin","0px 26px")}else{k.append(o)}c.find(".thumbwrapper ul").width(d);o.height(j+20);k.find("a").each(function(){a(this).height(j).width(i);f(a(this).find("img"))});c.find(".thumbwrapper ul li:first").addClass("active")}}).appendTo(a(this))})}var t=c.find(".imagemain");var u=t.width();var v=t.height();var w=t.find("img").attr("src");t.find("img").attr("src","").attr("src",w).load(function(b){f(a(this));t.addClass("ready")});if(b.captions){var x=a(this).find("img").attr("alt");var y=a("<span/>",{"class":"caption"}).html(x).hide().appendTo(t).fadeIn("500");if(b.captionShow){y.css({"z-index":100})}}if(b.zoomIndicator){a("<div/>",{"class":"zoomindicator"}).prependTo(t)}a(".imagethumbs li").live("click",function(c){if(!a(this).hasClass("active")){var d=a(this).parents(".thumbnailwrapper");var e=a(this).find("a").get(0).href;var f=a(this).find("a").attr("rel");var g=d.find(".imagemain");var h=g.find("img");margintop=0;marginleft=0;g.find(".zoomer").remove();g.find(".zoomlens").remove();g.attr("href",e);g.removeClass("ready");h.attr("src","").attr("src",f).load(function(){if(h.width()<u){marginleft=(u-h.width())/2}else{marginleft=0}if(h.height()<v){margintop=(v-h.height())/2}else{margintop=0}h.css({"margin-top":margintop,"margin-left":marginleft})});d.find(".imagethumbs li").removeClass("active").removeClass("arrow");a(this).addClass("active");a(this).addClass("arrow");if(b.captions){var i=a(this).find("img").attr("alt");h.attr("alt",i);d.find(".caption").html(i)}}a(this).find("a").blur();c.preventDefault()});c.find(".leftnavclick.active").live("click",function(b){a(this).removeClass("active");d(a(this),1,c,g);b.preventDefault()});c.find(".rightnavclick.active").live("click",function(b){a(this).removeClass("active");d(a(this),0,c,g);b.preventDefault()});if(b.zoom){c.find(".imagemain").hover(function(c){if(a(this).hasClass("ready")){var d=a(this);if(b.zoomIndicator){d.find(".zoomindicator").stop(true,true).delay(150).fadeOut(150)}var f=d.find(".zoomer");if(!f.length){var g=d.find("img");var h=d.get(0).href;var i=d.width()+50;if(b.zoomPos=="inside"){i=0}if(b.zoomLocation=="left"){i=-i}if(h){$zoomdiv=a("<span/>",{"class":"zoomer"}).css({width:d.width(),height:d.height(),left:i,top:0}).appendTo(d);if(b.zoomPos=="inside"){$zoomdiv.css({border:0})}var j=g.width();var k=g.height();$zoomedimg=a("<img/>",{src:h}).hide().appendTo(d.find(".zoomer")).fadeIn("1000").load(function(){var f=a(this).width();var h=a(this).height();var i=j/f*100;var l=k/h*100;$lens=a("<span/>",{"class":"zoomlens"}).css({width:g.parent().width()/100*i,height:g.parent().height()/100*l}).hide(0,function(){if(b.zoomPos=="inside"){a(this).css({border:0,background:"none"})}}).appendTo(d).fadeIn("600");e(d,c)})}}else{a(this).find(".zoomer").stop(false,true).fadeIn("1000");a(this).find(".zoomlens").stop(false,true).fadeIn("600")}}},function(){a(this).find(".zoomer").stop(false,true).fadeOut("500");a(this).find(".zoomlens").stop(false,true).fadeOut("500");if(b.zoomIndicator){a(this).find(".zoomindicator").stop(true,true).delay(150).fadeIn(150)}});c.find(".zoomer").live("hover",function(){if(b.zoomPos!="inside"){a(this).parent().find(".zoomer").stop(false,true).fadeOut("500");a(this).parent().find(".zoomlens").stop(false,true).fadeOut("500")}});c.find(".imagemain").mousemove(function(b){e(a(this),b)})}c.find(".imagemain").click(function(a){a.preventDefault()})})}}