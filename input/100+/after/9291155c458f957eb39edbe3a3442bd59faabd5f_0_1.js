function(d){var f=void (0),e=window.$nos=d,a=f,b=function(){if(a===f){a=d(".nos-ostabs")}return a},c={dialogOpened:[],dialogFocused:-1,open:function(i){var g=this,h=i.data("callbacks.nosdialog");g.dialogOpened.push(i[0]);if(!d.isPlainObject(h)){i.data("callbacks.nosdialog",{})}},focus:function(j){var g=this,i=j.data("callbacks.nosdialog"),h=d.inArray(j[0],g.dialogOpened);if(h!==-1){g.dialogOpened.splice(h,1)}g.dialogOpened.push(j[0]);g.dialogFocused=j[0];if(d.isPlainObject(i)){d.each(i,function(k,l){g.fireDialogEvent(j,l)});j.data("callbacks.nosdialog",{})}},close:function(i){var g=this,h=d.inArray(i[0],g.dialogOpened);if(h!==-1){g.dialogOpened.splice(h,1)}if(h>0){g.focus(d(g.dialogOpened[h-1]))}},fireDialogEvent:function(h,g){var j=h.find("> iframe");if(j.size()){if(j[0].contentDocument.$){j[0].contentDocument.$("body").trigger(g)}}else{try{h.trigger(g)}catch(i){log("fireDialogEvent error",i,g)}}},dispatchEvent:function(h){var g=this;d.each(g.dialogOpened,function(){var j=d(this);if(this===g.dialogFocused){g.fireDialogEvent(j,h)}else{var i=j.data("callbacks.nosdialog");if(d.isPlainObject(i)){i[h.type+(h.namespace?"."+h.namespace:"")]=h}}})}};d.extend({nosDispatchEvent:function(h){if(window.parent!=window&&window.parent.$nos){return window.parent.$nos.nosDispatchEvent(h)}var g=b(),i=d.Event("noviusos",{noviusos:h});g.ostabs("dispatchEvent",i);c.dispatchEvent(i);return d},nosNotify:function(g,h){if(window.parent!=window&&window.parent.$nos){return window.parent.$nos.nosNotify(g,h)}if(!d.isPlainObject(g)){g={title:g}}if(h!==f){d.extend(g,d.isPlainObject(h)?h:{type:h})}if(d.isPlainObject(g)){require(["link!static/novius-os/admin/vendor/jquery/pnotify/jquery.pnotify.default.css","static/novius-os/admin/vendor/jquery/pnotify/jquery.pnotify"],function(){return d.pnotify(d.extend({styling:"jqueryui",history:false,addclass:"nos-notification"},g))})}return false}});d.fn.extend({nosAjax:function(j){var h=d.extend({dataType:"json",type:"POST",data:{}},j||{}),k=h.success,i=h.error,g=this;if(h.dataType=="json"){h.success=function(l){if(d.isFunction(k)){l.user_success=k}g.nosAjaxSuccess(l)};h.error=function(l){g.nosAjaxError(l);if(d.isFunction(i)){i.call(this,j)}}}return d.ajax(h)},nosAjaxSuccess:function(k){if(k.error){if(d.isArray(k.error)){d.each(k.error,function(){d.nosNotify(this,"error")})}else{d.nosNotify(k.error,"error")}}if(k.internal_server_error){var l=k.internal_server_error;var m="An internal server error has been detected.\n\n";m+=l.type+" [ "+l.severity+" ]: "+l.message+"\n";m+=l.filepath+" @ line "+l.error_line+"\n\n";m+="Backtrace:\n";for(var j=0;j<l.backtrace.length;j++){m+=(j+1)+": "+l.backtrace[j].file+" @ line "+l.backtrace[j].line+"\n"}if(console){console.error(m)}}if(k.notify){if(d.isArray(k.notify)){d.each(k.notify,function(){d.nosNotify(this)})}else{d.nosNotify(k.notify)}}if(d.isFunction(k.user_success)){k.user_success.call(this,k)}var h=this.closest(".ui-dialog-content").size();if(h){if(k.closeTab){this.nosTabs("close")}}else{if(k.redirect){document.location.href=k.redirect}if(k.replaceTab){this.nosTabs("update",{url:k.replaceTab,reload:true})}}if(k.dispatchEvent){var g=k.dispatchEvent;if(!d.isArray(g)){g=[g]}d.each(g,function(n,o){d.nosDispatchEvent(o)})}return this},nosAjaxError:function(g,h){if(g.status!=0){d.nosNotify("Connection error!","error")}else{if(h=="parsererror"){d.nosNotify("Request seemed a success, but we could not read the answer.")}else{if(h=="timeout"){d.nosNotify("Time out (server is busy?). Please try again.")}}}return this},nosSaveUserConfig:function(g,h){this.nosAjax({url:"/admin/nos/noviusos/save_user_configuration",data:{key:g,configuration:h}});return this},nosMedia:function(j){j=j||{};var g={all:"/admin/nos/media/list",image:"/admin/nos/media/list?view=image_pick"},k=this;var i=null;var h=d.extend({title:k.attr("title")||"File",allowDelete:true,choose:function(){if(i===null){i=k.nosDialog({destroyOnClose:false,contentUrl:g[j.mode],ajax:true,title:"Choose a media file"});i.bind("select_media",function(m,l){k.inputFileThumb({file:l.thumbnail});k.val(l.id);i.nosDialog("close")})}else{i.nosDialog("open")}}},j.inputFileThumb||{});require(["static/novius-os/admin/vendor/jquery/jquery-ui-input-file-thumb/js/jquery.input-file-thumb","link!static/novius-os/admin/vendor/jquery/jquery-ui-input-file-thumb/css/jquery.input-file-thumb.css"],function(){d(function(){k.inputFileThumb(h)})});return this},nosFormUI:function(){var g=this;g.find(":input[type='text'],:input[type='password'],:input[type='email'],textarea").wijtextbox();g.find(":input[type='submit'],button").each(function(){var h={};var i=d(this).data("icon");if(i){h.icons={primary:"ui-icon-"+i}}d(this).button(h)});g.find("select").filter(":not(.notransform)").nosOnShow("one",function(){d(this).wijdropdown()});g.find(":input[type=checkbox]").nosOnShow("one",function(){d(this).wijcheckbox()});g.find(":input[type=radio]").filter(":not(.notransform)").nosOnShow("one",function(){d(this).wijradio()});g.find(".expander").each(function(){var h=d(this);h.wijexpander(d.extend({expanded:true},h.data("wijexpander-options")))});g.find(".accordion").wijaccordion({header:"h3",selectedIndexChanged:function(i,h){d(i.target).find(".ui-accordion-content").eq(h.newIndex).nosOnShow()}});return g},nosFormValidate:function(h){var g=this;h=h||{};if(!g.is("form")){g=g.find("form")}require(["jquery-nos-validate"],function(){g.validate(d.extend({},h,{errorClass:"ui-state-error",success:true,ignore:"input[type=hidden]"}))});return this},nosFormAjax:function(){var g=this;if(!g.is("form")){g=g.find("form")}require(["jquery-form"],function(){g.ajaxForm({dataType:"json",success:function(h){g.nosAjaxSuccess(h).triggerHandler("ajax_success",[h])},error:function(){d.nosNotify("An error occured","error")}})});return this},nosOnShow:function(){var g=Array.prototype.slice.call(arguments),i="show";if(g.length>0&&d.inArray(g[0],["one","bind","show"])!==-1){i=g.shift()}switch(i){case"one":case"bind":var h=g[0];if(!d.isFunction(h)){return}this.each(function(){var k=d(this),j=k.data("nos-on-show")||0;k.addClass("nos-on-show").data("nos-on-show",j+(i==="bind"?1:0))[i]("nos-on-show",h);if(k.is(":visible")){k.nosOnShow()}});break;case"show":this.not(".nos-on-show-exec").addClass("nos-on-show-exec").each(function(){var k=d(this),j=k.data("nos-on-show")||0;if(k.is(".nos-on-show")){k.css("display","block")}if(!k.is(":visible")){return true}if(k.is(".nos-on-show")){if(!j){k.removeClass("nos-on-show")}k.trigger("nos-on-show")}k.find(".nos-on-show").not(".nos-on-show-exec").nosOnShow()}).removeClass("nos-on-show-exec");break}return this},nosConfirmationDialog:function(i){var g=this;var h={confirm_deletion:"Confirm the deletion",or:"or",cancel:"Cancel",wrong_confirmation:"Wrong confirmation"};if(i.i18n){h=i.i18n}else{if(i.appDesk){h.confirm_deletion=i.appDesk.i18n("Confirm the deletion").label;h.or=i.appDesk.i18n("or").label;h.cancel=i.appDesk.i18n("Cancel").label;h.wrong_confirmation=i.appDesk.i18n("Wrong confirmation").label}}if(!i){i={}}i=d.extend({ajax:true,width:500,height:"auto","class":"nos-confirmation-dialog",dialogRendered:function(p){var m=d('<form class="fieldset standalone"></form>');var l=d("<p></p>");var k=d('<button type="submit" class="primary ui-state-error"></button>').data("icon","trash").append(h.confirm_deletion);var j=d('<a href="#"></a>').append(h.cancel);var o=d("<span></span>").text(" "+h.or+" ");var n=p.find(".verification");k.appendTo(l);o.appendTo(l);j.appendTo(l);l.appendTo(p);k.click(function(q){q.preventDefault();var r=true;n.each(function(){if(n.val().length==0||n.val()!=n.data("verification")){r=false;return false}});if(r){if(d.isFunction(i.confirmed)){i.confirmed(p)}p.nosDialog("close")}else{d.nosNotify(h.wrong_confirmation,"error")}});j.click(function(q){q.preventDefault();p.nosDialog("close")});p.wrapInner(m);p.parent().nosFormUI()}},i);g.nosDialog(i)},nosDialog:function(){var k=Array.prototype.slice.call(arguments),g="open";if(k.length>0&&d.inArray(k[0],["open","close"])!==-1){g=k.shift()}switch(g){case"open":if(this.is(".ui-dialog")){this.wijdialog("open");return this}var o=k[0]||{},p=d.extend(true,{},{destroyOnClose:true,width:window.innerWidth-200,height:window.innerHeight-100,modal:true,captionButtons:{pin:{visible:false},refresh:{visible:o.contentUrl!=null&&!o.ajax},toggle:{visible:false},minimize:{visible:false},maximize:{visible:false}}},o),l={open:p.open,close:p.close,focus:p.focus},m=this.closest(".nos-dispatcher, body"),n=this,h=d("<div></div>").addClass("nos-dispatcher").appendTo(m);d.extend(p,{close:function(r,q){c.close(h);if(d.isFunction(l.close)){l.close.apply(h,arguments)}if(p.destroyOnClose){h.wijdialog("destroy").remove()}else{h.closest(".ui-dialog").hide().appendTo(m)}},focus:function(r,q){c.focus(h);if(d.isFunction(l.focus)){l.focus.apply(h,arguments)}},open:function(r,q){c.open(h);if(d.isFunction(l.open)){l.open.apply(h,arguments)}if(!p.destroyOnClose){h.closest(".ui-dialog").appendTo("body")}}});if(p.content!==f){h.append(p.content)}if(p["class"]!==f){h.addClass(p["class"])}var j=true;if(p.ajax&&p.contentUrl){var i=p.contentUrl;delete p.contentUrl;p.autoOpen=false;h.wijdialog(p);d.ajax({url:i,type:"GET",dataType:"html",data:p.ajaxData||{},complete:function(s,q,t){t=s.responseText;if(s.isResolved()){s.done(function(v){t=v});try{var r=d.parseJSON(t);j=false}catch(u){}if(j){h.wijdialog("open").html(t);d.isFunction(p.dialogRendered)&&p.dialogRendered(h)}else{h.empty().wijdialog("destroy").remove();n.nosAjaxSuccess(r)}}}})}else{h.wijdialog(p);d.isFunction(p.dialogRendered)&&p.dialogRendered(h)}if(j&&d.isFunction(p.onLoad)){p.onLoad()}return h;break;case"close":this.closest(":wijmo-wijdialog").wijdialog("close");break}return this},nosListenEvent:function(g,i){var h=this;this.closest(".nos-dispatcher, body").on("noviusos",function(k){var j=true;k.noviusos=k.noviusos||{};d.each(g,function(l,m){if(k.noviusos[l]!==m){j=false;return false}});if(j){i(k.noviusos)}});return h},nosTabs:function(){var h=Array.prototype.slice.call(arguments),j="open",i=function(k){if(window.parent!=window&&window.parent.$nos){return window.parent.$nos(window.frameElement).data("nos-ostabs-index")}var l=d(k).parents(".nos-ostabs-panel-content");if(l.size()){return l.data("nos-ostabs-index")}return false},g=this;if(h.length>0&&d.inArray(h[0],["open","close","add","update","init"])!==-1){j=h.shift()}switch(j){case"open":(function(){var n=h[0]||{},m=h[1]||{},l=g.closest(".ui-dialog-content").size();if(l){g.nosDialog(d.extend({contentUrl:n.url,ajax:!n.iframe,title:n.label},m))}else{if(window.parent!=window&&window.parent.$nos){window.parent.$nos(window.frameElement).nosTabs("open",n,m)}else{if(b().length){var k=b().ostabs("tabs"),o=false;d.each(k,function(q,p){if(p.url===n.url){o=q;return false}});if(o!==false){return b().ostabs("select",o+4)}else{g.nosTabs("add",n)}}else{if(n.url){window.open(n.url)}}}}})();break;case"add":(function(){var m=h[0],k=h[1]||"end";if(window.parent!=window&&window.parent.$nos){window.parent.$nos(window.frameElement).nosTabs("add",m,k)}else{var l;if(d.inArray(k,["before","after"])!==-1){l=i(g)+(k==="before"?-1:1)}if(b().length){l=b().ostabs("add",m,l);b().ostabs("select",l)}else{if(m.url){window.open(m.url)}}}})();break;case"close":(function(){var l=g.closest(":wijmo-wijdialog");if(l.size()){g.nosDialog("close")}else{if(window.parent!=window&&window.parent.$nos){window.parent.$nos(window.frameElement).nosTabs("close")}else{var k=i(g);if(b().length){b().ostabs("remove",k)}}}})();break;case"update":(function(){var l=h[0];if(window.parent!=window&&window.parent.$nos){window.parent.$nos(window.frameElement).nosTabs("update",l)}else{if(g.size()&&!g.closest(".ui-dialog-content").size()&&b().length){var k=i(g);b().ostabs("update",k,l)}}})();break;case"init":(function(){var m=h[0],l=false,k=function(){if(b().length){if(l){clearTimeout(l)}l=setTimeout(function(){b().nosSaveUserConfig("tabs",{selected:b().ostabs("option","selected"),tabs:b().ostabs("tabs")})},500)}};a=g;d.extend(m,{add:k,remove:k,select:k,show:k,drag:k,update:k});if(m.user_configuration["tabs"]){if(!m.options){m.options={}}m.initTabs=m.user_configuration["tabs"]["tabs"];m.selected=m.user_configuration["tabs"]["selected"]}a.ostabs(m)})();break}return this}});return d}