function(){var e=Handlebars.template,t=Handlebars.templates=Handlebars.templates||{};t.header=e(function(e,t,n,r,i){n=n||e.helpers;var s,o=this;return"<h1>\n  <i class=icon-leaf></i>\n  Oregano\n</h1>\n<h2>A pinch at a time.</h2>\n<div id=new-url></div>\n"})})(),function(){var e=Handlebars.template,t=Handlebars.templates=Handlebars.templates||{};t.new_url=e(function(e,t,n,r,i){n=n||e.helpers;var s,o=this;return'<form>\n  <input id=new-url-input type=url name=url\n      placeholder="type a url, then press enter" autofocus></input>\n</form>\n'})}(),function(){var e=Handlebars.template,t=Handlebars.templates=Handlebars.templates||{};t.url=e(function(e,t,n,r,i){n=n||e.helpers;var s="",o,u,a=this,f="function",l=n.helperMissing,c=void 0,h=this.escapeExpression;return s+="<article id=url-",u=n.id,o=u||t.id,typeof o===f?o=o.call(t,{hash:{}}):o===c&&(o=l.call(t,"id",{hash:{}})),s+=h(o)+' class="',u=n.classNames,o=u||t.classNames,typeof o===f?o=o.call(t,{hash:{}}):o===c&&(o=l.call(t,"classNames",{hash:{}})),s+=h(o)+'">\n  <h1>',u=n.url,o=u||t.url,typeof o===f?o=o.call(t,{hash:{}}):o===c&&(o=l.call(t,"url",{hash:{}})),s+=h(o)+'</h1>\n  <div class=controls>\n    <a href="#urls/',u=n.id,o=u||t.id,typeof o===f?o=o.call(t,{hash:{}}):o===c&&(o=l.call(t,"id",{hash:{}})),s+=h(o)+'/view" class=view>\n      <i class=icon-external-link></i>\n    </a>\n    <a href="#urls/',u=n.id,o=u||t.id,typeof o===f?o=o.call(t,{hash:{}}):o===c&&(o=l.call(t,"id",{hash:{}})),s+=h(o)+'/pinch" class=pinch>\n      <i class=icon-leaf></i>\n    </a>\n  </div>\n</article>\n',s})}(),function(){var e=function(t){if(!(this instanceof e))return new e(t);this._0=t},t=function(e){if(!(this instanceof t))return new t(e);this._0=e},n=function(e){if(!(this instanceof n))return new n(e);this._0=e},r={},i=function(e){return e()},s=new Bacon.Bus,o="body > header",u="#new-url",a="#new-url-input",f=u+" form",l="#urls",c=function(e){return'a[href="#urls/'+e+'/view"]'},h=function(e){return'a[href="#urls/'+e+'/pinch"]'},p={"return":function(e){return $.when(e)},bind:function(e,t){var n=$.Deferred();return e.done(function(e){return t(e).done(n.resolve)}),n.promise()}},d=function(){return document.location.hash.substr(1)},v=function(){return $(document).ready(function(){var e=$(o);return e.html(Handlebars.templates.header())})},m=function(){return $(document).ready(function(){var t=$(u);t.html(Handlebars.templates.new_url());var n=$(a);n.focus();var r=$(f),i=r.asEventStream("submit");return s.plug(i.map(function(t){return t.preventDefault(),e(r.serializeObject())}))})},g=function(e){return $(document).ready(function(){var t=$(l);return t.hide(),e.map(y),t.fadeIn()})},y=function(e){return $(document).ready(function(){var r=$(l),i=$(Handlebars.templates.url(e));i.hide(),r.prepend(i),i.fadeIn();var o=$(c(e.id)),u=o.asEventStream("click");s.plug(u.map(function(t){return t.preventDefault(),n(e)}));var a=$(h(e.id)),f=a.asEventStream("click");return s.plug(f.map(function(n){return n.preventDefault(),t(e)}))})};s.onValue(function(r){return function(){if(r instanceof e){var s=r._0;return i(function(){return $(f)[0].reset(),function(){var e=p;return e.bind($.post("/urls",function(e,t){var n={},r;for(r in e)n[r]=e[r];for(r in t)n[r]=t[r];return n}(s,{key:d()})),function(t){return e.bind(p.return(y(t)),function(n){return e.return($("#url-"+t.id).addClass("url"))})})}()})}if(r instanceof n){var s=r._0;return i(function(){var e="/urls/"+s.id+"/view";return $.post(e,function(e,t){var n={},r;for(r in e)n[r]=e[r];for(r in t)n[r]=t[r];return n}(s,{key:d()})),$("#url-"+s.id).addClass("views"),window.open(s.url)})}if(r instanceof t){var s=r._0;return i(function(){var e="/urls/"+s.id+"/pinch";return $.post(e,function(e,t){var n={},r;for(r in e)n[r]=e[r];for(r in t)n[r]=t[r];return n}(s,{key:d()})),$("#url-"+s.id).addClass("pinches")})}}()}),v(),m(),function(){var e=p;return e.bind($.get("/urls",{key:d()}),function(t){return e.return(g(t.map(function(e){return function(e,t){var n={},r;for(r in e)n[r]=e[r];for(r in t)n[r]=t[r];return n}(e,{classNames:e.relTypes.concat(["url"]).join(" ")})})))})}()}