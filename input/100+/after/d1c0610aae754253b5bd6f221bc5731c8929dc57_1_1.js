function(c){var i=40,h=13,f=27,l=9,g=38,j=39,e="down:39+shift",d="down:37+shift",b=true,k=false,a=function(m){a.superclass.constructor.apply(this,arguments);};a.NAME="Navigation";a.ATTRS={activeRegistryIndex:{value:null},registry:[]};c.extend(a,c.Base,{container:{containerId:null,children:[],childIndexInFocus:-1},initializer:function(m){var n=this;c.one("body").on("key",function(o){n.makeNextContainerNavigable(b);},e);c.one("body").on("key",function(o){n.makeNextContainerNavigable(k);},d);this.makeNextContainerNavigable();},makeNextContainerNavigable:function(n){var m=this.get("registry"),o;if(m.length>0){o=this.getNextRegistryIndex(n);if(o!==null&&m[o]){var p=c.one(m[o].node);if(p){this.deactivateRegisteredContainer();this.registerContainer(p);this.initiateNavigation();}else{this.deactivateRegisteredContainer();}}}else{}},getNextRegistryIndex:function(n){var m=this.get("registry"),p,q=null;if(m&&m.length>0){var o=0;for(o=0;o<m.length;o++){p=m.length;q=this.get("activeRegistryIndex");if(q===null){q=0;}else{q=n?(q+1):(q-1);if(q>=p){q=0;}if(q<0){q=p-1;}}this.set("activeRegistryIndex",q);if(c.one(m[q].node)){return q;}else{}}return q;}return null;},registerContainer:function(m){if(m){this.updateChildren(m);}},updateChildren:function(o){var n=o.all("> *");var m=[];n.each(function(r,p,q){m[p]=r;});this.container.children=m;this.container.containerId=o.generateID();},initiateNavigation:function(){this.activateRegisteredContainer();},deactivateRegisteredContainer:function(){this.killAllSubscription();this.removeHighlightonCurrentChild();this.resetContainer();},removeHighlightonCurrentChild:function(){var m=this.container;var n=m.childIndexInFocus;if(n!==null&&n!==-1){m.children[n].removeClass("highlight");}},resetRegistryIndex:function(){this.set("activeRegistryIndex",null);},resetContainer:function(){this.container={containerId:null,children:[],childIndexInFocus:-1};this.wasLastChild=false;},killAllSubscription:function(){if(c.BodySubscr){this.detachAllSubscriptions();}},activateRegisteredContainer:function(){c.BodySubscr={};c.BodySubscr.keydown=c.one("body").on("down",c.bind(this.onMyKeyDown,this));c.BodySubscr.keyup=c.one("body").on("up",c.bind(this.onMyKeyUp,this));},detachAllSubscriptions:function(){for(var m in c.BodySubscr){c.BodySubscr[m].detach();}delete c.BodySubscr;},onMyKeyDown:function(n){this.wasLastChild=false;if(this.container){n.preventDefault();var m=this.container,p=m.childIndexInFocus,o=this.getNextIndex(p);m.childIndexInFocus=o;this.bringChildtoFocus(m.children[o]);}},onMyKeyUp:function(n){if(this.container){n.preventDefault();var m=this.container,p=m.childIndexInFocus,o=this.getPreviousIndex(p);this.bringChildtoFocus(m.children[o]);m.childIndexInFocus=o;}},destructor:function(){delete this.anim;},animateScroll:function(m){this.anim=new c.Anim({node:"window",from:{scroll:[c.DOM.docScrollX(),c.DOM.docScrollY()]},to:{scroll:[c.DOM.docScrollX(),m]},duration:0.1,easing:c.Easing.easeNone}).run();},getNextIndex:function(o){var m=this.container,n=m.children.length;if(o!=-1){m.children[o].removeClass("highlight");}if(o===n-1){o=-1;this.wasLastChild=true;}else{this.wasLastChild=false;}o++;return o;},getPreviousIndex:function(o){var m=this.container,n=m.children.length;if(o>=0){m.children[o].removeClass("highlight");}if(o===0){o=n;}o--;if(o<0){o=0;}return o;},scrollToCenter:function(o){var q=o.getY(),m=o.get("clientHeight"),r=m/2,n=o.get("winHeight");if(m>n){r=0;}var p=n/2;if(q>p){if(this.anim&&this.anim.get("running")){this.anim.pause();}return q-p+r;}},bringChildtoFocus:function(o){o.addClass("highlight").focus();console.log("$$$$$$$$$$$$$$$$$$$$$$$$$$$");var m=o.all("> a");m.each(function(r,p,q){r.focus();});if(this.anim&&this.anim.get("running")){this.anim.pause();}if(this.wasLastChild){o.scrollIntoView();}if(this.container.childIndexInFocus===0){o.scrollIntoView();}var n=this.scrollToCenter(o);this.animateScroll(n);}});c.Nav=a;},"@VERSION@",{requires:["node","event","event-key","gallery-event-nav-keys","base","anim"],skinnable:false}