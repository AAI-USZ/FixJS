function(e,t,n){"use strict";e.fn.mobileBox=function(r){var i={counter:"{i} of {t}",isTouch:"ontouchstart"in t.documentElement};e.extend(i,r),e(this).addClass("_mobileBox"),e(this).click(function(t){e("#mobileBoxViewport").length?e("#mobileBoxViewport").attr("content","width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0;"):e("head").append('<meta name="viewport" id="mobileBoxViewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0;" />'),o=n.innerHeight,s=n.innerWidth;if(s>480||!i.isTouch)return;var r=e(this).attr("href"),u=e(this).attr("title"),h=e(this).attr("class").split(" "),p=new Image;p.src=r;var d=[];for(var v=0;v<h.length;v++){var m=h[v];if(m==="_mobileBox")continue;var g=e("."+m);for(var y=0;y<g.length;y++){var b=g[y];d.indexOf(b)===-1&&d.push(b)}}var w=e(d).index(this);return f(p,function(t,n,s){var o=d.length?d.length:1,f=i.counter.replace("{i}",w+1).replace("{t}",o),h=e(a.replace("{src}",r).replace("{title}",u).replace("{counter}",f));e(".mobileBox",h).append(this),e(".mobileBoxDone a",h).bind("click",l),e("body").prepend(h),c(e(".mobileBox"),d,w)}),!1});var s=0,o=0,u="landscape",a=['<div class="mobileBoxWrapper">','<div class="mobileBoxBg"></div>','<div class="mobileBox">','<div class="mobileBoxHeader">','<span class="mobileBoxDone"><a href="#done">Done</a></span>','<span class="mobileBoxCounter">{counter}</span>',"</div>",'<div class="mobileBoxTitle">{title}</div>',"</div>","<div>"].join(""),f=function(t,n){e(t).load(function(r){var i=r.currentTarget;i.width<i.height&&(u="portrait");var a=i.height;i.width<s&&e(t).css({width:i.width+"px"});if(i.height>i.width&&i.height>o){e(t).css({width:"auto",height:o-100+"px"});var f=i.width/i.height,l=f*o/2;e(t).css({"margin-left":l+"px"}),a=f*a+40}var c=o-a;c=c>=0?c/4:0,e(t).css({"margin-top":c+"px"}),n.call(t,i.width,i.height,c)})},l=function(){return e(".mobileBoxWrapper").fadeOut(function(){n.location=n.location}),!1},c=function(t,n,r){function h(e){var t=e.originalEvent.targetTouches[0];a.x=t.pageX,a.y=t.pageY}function p(e){var t=e.originalEvent.targetTouches[0];l.x=t.pageX,l.y=t.pageY,e.preventDefault()}function d(){}function v(){var e=a.y-l.y,t,n=c.threshold,r=n.y,s=n.x;e<r&&e>-r&&(t=a.x-l.x,t>s?c.swipeLeft.call(i):t<-s&&c.swipeRight.call(i))}var i=t,u=function(t){if(r+t>=0&&r+t<n.length){var i=r+t,u=e(n[i]);e(".mobileBox img").animate({left:(t<0?"+":"-")+"="+s},200,function(){e(this).remove()});var a=new Image;a.src=u.attr("href"),f(a,function(r,a,f){var l={},c=0;if(r<s){var h=r/a;c=h*o/2}t>0?(e(this).css({right:"-"+s+"px"}),l.right=c+"px"):(e(this).css({left:"-"+s+"px"}),l.left=c+"px"),e(".mobileBoxTitle").html(u.attr("title")),e(".mobileBoxCounter").html(i+1+" of "+n.length),e(".mobileBox").append(this),e(this).animate(l,200)}),r+=t}},a={x:0,y:0},l={x:0,y:0},c={threshold:{x:10,y:100},swipeLeft:function(){u(1)},swipeRight:function(){u(-1)}};e(i).bind("touchstart.swipe",h).bind("touchmove.swipe",p).bind("touchend.swipe",v).bind("touchcancel.swipe",d)}}}