function(y){y.name="mustache.js";y.version="0.5.0-dev";y.tags=["{{","}}"];y.parse=o;y.compile=g;y.render=x;y.clearCache=w;y.to_html=function(C,A,B,D){var z=x(C,A,B);if(typeof D==="function"){D(z)}else{return z}};var u=Object.prototype.toString;var h=Array.isArray;var d=Array.prototype.forEach;var i=String.prototype.trim;var k;if(h){k=h}else{k=function(z){return u.call(z)==="[object Array]"}}var t;if(d){t=function(A,B,z){return d.call(A,B,z)}}else{t=function(C,D,B){for(var A=0,z=C.length;A<z;++A){D.call(B,C[A],A,C)}}}var m=/^\s*$/;function e(z){return m.test(z)}var r;if(i){r=function(z){return z==null?"":i.call(z)}}else{var p,j;if(e("\xA0")){p=/^\s+/;j=/\s+$/}else{p=/^[\s\xA0]+/;j=/[\s\xA0]+$/}r=function(z){return z==null?"":String(z).replace(p,"").replace(j,"")}}var f={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};function q(z){return String(z).replace(/[&<>"'\/]/g,function(A){return f[A]||A})}function n(F,H,I,B){B=B||"<template>";var J=H.split("\n"),z=Math.max(I-3,0),C=Math.min(J.length,I+3),A=J.slice(z,C);var G;for(var D=0,E=A.length;D<E;++D){G=D+z+1;A[D]=(G===I?" >> ":"    ")+A[D]}F.template=H;F.line=I;F.file=B;F.message=[B+":"+I,A.join("\n"),"",F.message].join("\n");return F}function v(z,H,G){if(z==="."){return H[H.length-1]}var F=z.split(".");var D=F.length-1;var E=F[D];var I,A,C=H.length,B,J;while(C){J=H.slice(0);A=H[--C];B=0;while(B<D){A=A[F[B++]];if(A==null){break}J.push(A)}if(A&&typeof A==="object"&&E in A){I=A[E];break}}if(typeof I==="function"){I=I.call(J[J.length-1])}if(I==null){return G}return I}function l(C,z,G,B){var A="";var E=v(C,z);if(B){if(E==null||E===false||(k(E)&&E.length===0)){A+=G()}}else{if(k(E)){t(E,function(H){z.push(H);A+=G();z.pop()})}else{if(typeof E==="object"){z.push(E);A+=G();z.pop()}else{if(typeof E==="function"){var D=z[z.length-1];var F=function(H){return x(H,D)};A+=E.call(D,G(),F)||""}else{if(E){A+=G()}}}}}return A}function o(ab,D){D=D||{};var M=D.tags||y.tags,N=M[0],I=M[M.length-1];var A=['var buffer = "";',"\nvar line = 1;","\ntry {",'\nbuffer += "'];var H=[],ac=false,Z=false;var X=function(){if(ac&&!Z&&!D.space){while(H.length){A.splice(H.pop(),1)}}else{H=[]}ac=false;Z=false};var U=[],R,E,O;var W=function(ad){M=r(ad).split(/\s+/);E=M[0];O=M[M.length-1]};var L=function(ad){A.push('";',R,'\nvar partial = partials["'+r(ad)+'"];',"\nif (partial) {","\n  buffer += render(partial,stack[stack.length - 1],partials);","\n}",'\nbuffer += "')};var z=function(af,ad){var ae=r(af);if(ae===""){throw n(new Error("Section name may not be empty"),ab,K,D.file)}U.push({name:ae,inverted:ad});A.push('";',R,'\nvar name = "'+ae+'";',"\nvar callback = (function () {","\n  return function () {",'\n    var buffer = "";','\nbuffer += "')};var G=function(ad){z(ad,true)};var V=function(ae){var ad=r(ae);var ag=U.length!=0&&U[U.length-1].name;if(!ag||ad!=ag){throw n(new Error('Section named "'+ad+'" was never opened'),ab,K,D.file)}var af=U.pop();A.push('";',"\n    return buffer;","\n  };","\n})();");if(af.inverted){A.push("\nbuffer += renderSection(name,stack,callback,true);")}else{A.push("\nbuffer += renderSection(name,stack,callback);")}A.push('\nbuffer += "')};var Y=function(ad){A.push('";',R,'\nbuffer += lookup("'+r(ad)+'",stack,"");','\nbuffer += "')};var B=function(ad){A.push('";',R,'\nbuffer += escapeHTML(lookup("'+r(ad)+'",stack,""));','\nbuffer += "')};var K=1,aa,F;for(var S=0,T=ab.length;S<T;++S){if(ab.slice(S,S+N.length)===N){S+=N.length;aa=ab.substr(S,1);R="\nline = "+K+";";E=N;O=I;ac=true;switch(aa){case"!":S++;F=null;break;case"=":S++;I="="+I;F=W;break;case">":S++;F=L;break;case"#":S++;F=z;break;case"^":S++;F=G;break;case"/":S++;F=V;break;case"{":I="}"+I;case"&":S++;Z=true;F=Y;break;default:Z=true;F=B}var C=ab.indexOf(I,S);if(C===-1){throw n(new Error('Tag "'+N+'" was not closed properly'),ab,K,D.file)}var Q=ab.substring(S,C);if(F){F(Q)}var P=0;while(~(P=Q.indexOf("\n",P))){K++;P++}S=C+I.length-1;N=E;I=O}else{aa=ab.substr(S,1);switch(aa){case'"':case"\\":Z=true;A.push("\\"+aa);break;case"\r":break;case"\n":H.push(A.length);A.push("\\n");X();K++;break;default:if(e(aa)){H.push(A.length)}else{Z=true}A.push(aa)}}}if(U.length!=0){throw n(new Error('Section "'+U[U.length-1].name+'" was not closed properly'),ab,K,D.file)}X();A.push('";',"\nreturn buffer;","\n} catch (e) { throw {error: e, line: line}; }");var J=A.join("").replace(/buffer \+= "";\n/g,"");if(D.debug){if(typeof console!="undefined"&&console.log){console.log(J)}else{if(typeof print==="function"){print(J)}}}return J}function s(D,B){var A="view,partials,stack,lookup,escapeHTML,renderSection,render";var z=o(D,B);var C=new Function(A,z);return function(F,G){G=G||{};var E=[F];try{return C(F,G,E,v,q,l,x)}catch(H){throw n(H.error,D,H.line,B.file)}}}var c={};function w(){c={}}function g(A,z){z=z||{};if(z.cache!==false){if(!c[A]){c[A]=s(A,z)
}return c[A]}return s(A,z)}function x(B,z,A){return g(B)(z,A)}})(b);a.mustache=b})(require.modules);if("function"!=typeof(require)){throw"modules library required"}(function(a){var f=function(k){this.raw=k;this.records=[]};Object.extend(f.prototype,{raw:"",records:[],parse:function(){this.records=j(this.raw)}});Object.extend(f,{format:function(l,r){var q=require("mustache"),m=[],o=Array.apply(Array,arguments),n="<p>{{author}}. <em> {{title}}. </em> {{#booktitle}}In {{booktitle}}. {{/booktitle}}{{#pages}} pages {{pages}}, {{/pages}}{{#publisher}} {{publisher}}, {{/publisher}} {{year}}</p>";if(o.length>1){var p=o[o.length-1];if(b(p)){n=o.pop()}}if(o.length>1){m=o}else{if(o.length==1){if(b(o[0])){var k=new f(o[0]);k.parse();m=k.records}else{if(g(o[0])){m=o[0]}else{m=[o[0]]}}}else{o=[]}}m=m.filter(function(s){return !c(s)});if(0==m.length){return""}return m.map(function(t){for(var s in t){if("editor"==s||"author"==s){t[s]=e(t[s])}else{if("_raw"==s){}else{t[s]=d(t[s])}}}return q.render(n,t)}).join("")}});function c(k){return null===k||"undefined"==typeof(k)}function b(k){return !c(k)&&"function"==typeof(k.substring)}function g(k){return !c(k)&&"function"==typeof(k.slice)}function d(k){return k.replace(/^[\{\s]*/,"").replace(/[\s\}]*$/,"").replace(/\{?\\"\{?a\}*}/g,"ä").replace(/\{?\\"\{?o\}*}/g,"ö").replace(/\{?\\"\{?u\}*}/g,"ü").replace(/\{?\\"\{?A\}*}/g,"Ä").replace(/\{?\\"\{?O\}*}/g,"Ö").replace(/\{?\\"\{?U\}*}/g,"Ü").replace(/[~ ]-- /g," &ndash; ").replace(/[\n\r]{2,}/g,"<br/>")}function e(k){k=k.split(" and ");return k.map(function(l){return d(l)}).join(", ")}function j(o){var m=[],r="",q="",n=0,l=false,k="";for(var p=0;p<o.length;p++){r=o.charAt(p);if(0==n&&"@"==r){l=true}else{if(l&&"{"==r&&"\\"!=q){n++}else{if(l&&"}"==r&&"\\"!=q){n--;if(0>n){throw"More brackets were closed than opened"}if(0==n){l=false;m.push(h(k+r));k=""}}}}if(l){k+=r}q=r}if(l){throw"unterminated record: \n"+k}if(n){throw"unblanaced paranthesis: \n"+k}return m}