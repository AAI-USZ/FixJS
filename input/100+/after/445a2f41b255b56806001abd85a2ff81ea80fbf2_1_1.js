function(){function c(a,c){return localStorage.setItem(b+a,JSON.stringify(c))}function d(a){return JSON.parse(localStorage.getItem(b+a))}function e(){for(var a in localStorage){if(a.indexOf(b)===0){return localStorage.removeItem(a)}}}var a="";var b="unknown:";if(Modernizr.localstorage){var f=Backbone.sync;Backbone.sync=function(a,b,g){switch(a){case"create":case"update":case"delete":f.apply(this,arguments);break;case"read":if(typeof this.localStorage=="object"){var h=this.localStorage.id?this.localStorage.id:b.id;var i=d(h+":timestamp");if(h){if(g.forceRefresh||!i||this.localStorage.maxRefresh&&(new Date).getTime()-i>this.localStorage.maxRefresh){var j=g.success;g.success=function(a,b,d){try{c(h,a);c(h+":timestamp",(new Date).getTime())}catch(f){if(f==QUOTA_EXCEEDED_ERR){e()}}if(j){j.apply(this,arguments)}};f.apply(this,[a,b,g])}else{var k=d(h);setTimeout(function(){g.success(k,"success",null)},0)}}else{f.apply(this,arguments)}}else{f.apply(this,arguments)}break}}}else{console.warn("Local Storage is not supported!")}window.BackboneLocalStorage={setVersion:function(b){a=b;if(Modernizr.localstorage){var e=d("version");if(e&&e.toString()!=b){localStorage.clear();console.log("Local Storage is cleared since a different version is detected (from "+e+" to "+b+")!")}c("version",b.toString())}},setPrefix:function(a){b=a+":"}}}