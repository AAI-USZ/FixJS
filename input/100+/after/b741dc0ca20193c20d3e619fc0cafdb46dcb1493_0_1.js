function(){var a;a=0;window.AppModel=Backbone.Model.extend({hideMediaChooser:function(){return this.trigger("hideMediaChooser")},showMediaChooser:function(c,b){if(b==null){b=true}this.set("uid",c);return this.trigger("showMediaChooser",b)},assetSelectionCallback:function(b){return this.trigger("assetSelected",b)},showTextAreaModal:function(b,c){this.set("fullscreen_source_uid",b);return this.trigger("showTextAreaModal",c)},textAreaModalClosed:function(b){return this.trigger("textAreaModalChange",b)}});window.MediaChooserWidgetView=Backbone.View.extend({initialize:function(){this.chooseFileButton=$('<a href="#" class="btn choose-file-button">Choose file</a>').click(_.bind(this.chooseFileButtonClickHandler,this));this.$el.parent().prepend(this.chooseFileButton);this.$el.hide();this.uid=a;a++;return this.model.on("assetSelected",this.assetSelectedHandler,this)},chooseFileButtonClickHandler:function(b){this.model.showMediaChooser(this.uid);return b.preventDefault()},assetSelectedHandler:function(c){var b,d;if(this.model.get("uid")!==this.uid){return}this.$el.val(c.id);d=_.template($("#mediaAssetThumbnailTemplate").text());b=d({thumbnail_url:c.thumbnail_url,filename:c.filename});this.existingThumbnail=this.$el.parent().find(".media-asset-thumbnail");if(this.existingThumbnail.length>0){this.existingThumbnail.replaceWith(b)}else{this.$el.parent().prepend(b)}return this.model.hideMediaChooser()}});window.MediaChooserModalView=Backbone.View.extend({initialize:function(){this.$el.modal().modal("hide");this.model.on("showMediaChooser",this.show,this);return this.model.on("hideMediaChooser",this.hide,this)},show:function(b){this.$el.modal("show");if(!b){return $(".modal-backdrop:last").remove()}},hide:function(){return this.$el.modal("hide")}});window.TextAreaModalView=Backbone.View.extend({initialize:function(){this.$el.modal().modal("hide");this.textarea=$("#textarea-modal-textarea");return this.model.on("showTextAreaModal",this.show,this)},events:{"click #textarea-modal-done-button":"doneClickHandler"},show:function(b){this.$el.modal("show");return this.textarea.val(b)},doneClickHandler:function(){return this.model.textAreaModalClosed(this.textarea.val())}});window.RichTextAreaView=Backbone.View.extend({initialize:function(){this.uid=a;a++;this.controls=$($("#textarea-controls-template").text());this.assetButton=this.controls.find(".rich-text-asset-button");this.$el.parent().prepend(this.controls);this.assetButton.click(_.bind(this.assetButtonClickHandler,this));this.fullscreenButton=this.controls.find(".rich-text-fullscreen-button");if(this.options.noFullscreen){this.fullscreenButton.hide()}({"else":this.fullscreenButton.click(_.bind(this.fullscreenButtonClickHandler,this))});this.model.on("assetSelected",this.assetSelectedHandler,this);return this.model.on("textAreaModalChange",this.textAreaModalChangeHandler,this)},assetButtonClickHandler:function(b){if(this.options.hideMediaChooserBackdrop){this.model.showMediaChooser(this.uid,false)}else{this.model.showMediaChooser(this.uid)}return b.preventDefault()},assetSelectedHandler:function(b){if(this.model.get("uid")!==this.uid){return}Utilities.insertAtCaret(this.$el.attr("id"),b.url);return this.model.hideMediaChooser()},fullscreenButtonClickHandler:function(b){this.model.showTextAreaModal(this.uid,this.$el.val());return b.preventDefault()},textAreaModalChangeHandler:function(b){if(this.model.get("fullscreen_source_uid")!==this.uid){return}return this.$el.val(b)}})}