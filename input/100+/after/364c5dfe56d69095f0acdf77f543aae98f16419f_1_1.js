function(a){a(function(){var i,p,u,w;x.defer=h;x.reject=r;x.isPromise=j;x.all=d;
x.some=v;x.any=e;x.map=k;x.reduce=o;x.chain=f;i=Object.freeze||function(y){return y;
};function n(){}n.prototype=i({always:function(y,z){return this.then(y,y,z);},otherwise:function(y){return this.then(w,y);
}});function t(z){var y=new n();y.then=function(A){var C;try{if(A){C=A(z);}return m(C===w?z:C);
}catch(B){return s(B);}};return i(y);}function s(z){var y=new n();y.then=function(A,C){var D;
try{if(C){D=C(z);return m(D===w?z:D);}return s(z);}catch(B){return s(B);}};return i(y);
}function r(y){return x(y,function(z){return s(z);});}function h(){var B,F,C,E,z,y,A;
C=[];E=[];z=function J(K,M,N){var L=h();C.push(function(O){O.then(K,M).then(L.resolve,L.reject,L.progress);
});N&&E.push(N);return L.promise;};function I(K,L,M){return z(K,L,M);}function H(K){A(t(K));
}function G(K){A(s(K));}y=function(M){var L,K=0;while(L=E[K++]){L(M);}};function D(K){y(K);
}A=function(L){var N,M=0;z=L.then;A=y=function K(){throw new Error("already completed");
};E=w;while(N=C[M++]){N(L);}C=[];};B={};F=new n();F.then=B.then=I;B.promise=i(F);
B.resolver=i({resolve:(B.resolve=H),reject:(B.reject=G),progress:(B.progress=D)});
return B;}function j(y){return y&&typeof y.then==="function";}function x(B,y,z,A){var C=m(B);
return C.then(y,z,A);}function m(A){var z,y;if(A instanceof n){z=A;}else{y=h();if(j(A)){A.then(y.resolve,y.reject,y.progress);
z=y.promise;}else{y.resolve(A);z=y.promise;}}return z;}function v(C,A,y,z,B){g(2,arguments);
return x(C,function(J){var Q,O,P,E,N,L,F,H,G;H=J.length>>>0;Q=Math.max(0,Math.min(A,H));
O=[];E=h();P=x(E,y,z,B);function M(R){N(R);}function K(R){L(R);}function I(R){F(R);
}function D(){N=L=F=l;}if(!Q){E.resolve(O);}else{N=function(R){O.push(R);if(!--Q){D();
E.resolve(O);}};L=function(R){D();E.reject(R);};F=E.progress;for(G=0;G<H;++G){if(G in J){x(J[G],M,K,I);
}}}return P;});}function d(B,y,z,A){g(1,arguments);return x(B,function(C){return c(C,q,[]);
}).then(y,z,A);}function q(y,A,z){y[z]=A;return y;}function e(B,y,z,A){function C(D){return y?y(D[0]):D[0];
}return v(B,1,C,z,A);}function k(z,y){return x(z,function(A){return b(A,y);});}function b(B,A){var C,z,y;
z=B.length>>>0;C=new Array(z);for(y=0;y<z;y++){if(y in B){C[y]=x(B[y],A);}}return c(C,q,C);
}function o(A,B,z){var y=u.call(arguments,1);return x(A,function(C){return c.apply(w,[C].concat(y));
});}function c(A,B,z){var C,y;C=A.length;y=[function(D,F,E){return x(D,function(G){return x(F,function(H){return B(G,H,E,C);
});});}];if(arguments.length>2){y.push(z);}return p.apply(A,y);}function f(y,z,A){var B=arguments.length>2;
return x(y,function(C){if(B){C=A;}z.resolve(C);return C;},function(C){z.reject(C);
return s(C);},z.progress);}function g(B,z){var y,A=z.length;while(A>B){y=z[--A];if(y!=null&&typeof y!="function"){throw new Error("callback is not a function");
}}}function l(){}u=[].slice;p=[].reduce||function(D){var z,y,C,B,A;A=0;z=Object(this);
B=z.length>>>0;y=arguments;if(y.length<=1){for(;;){if(A in z){C=z[A++];break;}if(++A>=B){throw new TypeError();
}}}else{C=y[1];}for(;A<B;++A){if(A in z){C=D(C,z[A],A,z);}}return C;};return x;});
}