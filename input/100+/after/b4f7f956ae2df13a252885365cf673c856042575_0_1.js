function(a){if(typeof this!="function")throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){try{return c.apply(this instanceof d?this:a,b.concat(Array.prototype.slice.call(arguments)))}catch(e){return c.apply(a,b.concat(Array.prototype.slice.call(arguments)))}};return d.prototype=this.prototype,e.prototype=new d,e});var a2d={version:"0.4.0.2",a2dCanvas:null,a2dRoot:null,a2dFullSCreen:!1,forceClear:!1,resources:[],loaded:!1,logicInterval:30,mute:!1,load:function(a){var b;for(b in a)a.hasOwnProperty(b)&&(a[b].match(/png$|jpg$|jpeg$|gif$|bmp$/i)?this.resources[b]=new Image:this.resources[b]=new a2d.Audio,this.resources[b].onload=this.progress,this.resources[b].onreadystatechange=function(){this.progress()},this.resources[b].src=a[b]);this.progress()},progress:function(){var a,b=0,c=0;if(!a2d.loaded){for(a in a2d.resources)a2d.resources.hasOwnProperty(a)&&((a2d.resources[a].width&&a2d.resources[a].width>0||a2d.resources[a].audioLoaded)&&c++,b++);c==b?(a2d.loaded=!0,a2d.fireEvent("load")):a2d.fireEvent("progress",{loaded:c,total:b})}},get canvas(){if(!this.a2dCanvas){console.log("acquire canvas"),document&&document.getElementsByTagName&&(this.a2dCanvas=document.getElementsByTagName("canvas")[0]);if(!this.a2dCanvas){this.a2dCanvas=document.createElement("canvas"),document.body.appendChild(this.a2dCanvas);var a=new a2d.Dimension(window.innerWidth,window.innerHeight);this.a2dCanvas.width=a.Width,this.a2dCanvas.height=a.Height}a2d.mousePosition=new a2d.Position(0,0),this.a2dCanvas.addEventListener("mousemove",function(a){var b=a.clientX+a2d.canvas.offsetLeft,c=a.clientY+a2d.canvas.offsetTop;a2d.mousePosition=new a2d.Position(b,c)}),this.a2dCanvas.addEventListener("mousedown",function(a){var b=a2d.root.findNodeAt(a2d.mousePosition);b&&b.fireEvent.call(b,"mousedown")}),this.a2dCanvas.addEventListener("mouseup",function(a){var b=a2d.root.findNodeAt(a2d.mousePosition);b&&(b.fireEvent.call(b,"mouseup"),b.fireEvent.call(b,"click"))}),window.addEventListener("resize",this.onResize),this.context=this.a2dCanvas.getContext("2d")}return this.a2dCanvas},onResize:function(){this.a2dCanvas&&(this.a2dCanvas.style.position="absolute",this.a2dCanvas.style.width="100%",this.a2dCanvas.style.height="100%",this.a2dCanvas.style.top="0",this.a2dCanvas.style.left="0",this.dimension=new a2d.Dimension(parseInt(getComputedStyle(canvas,null).getPropertyCSSValue("height").cssText,10),parseInt(getComputedStyle(canvas,null).getPropertyCSSValue("width").cssText,10)))},set canvas(a){this.a2dCanvas=document.getElementById(a)},get dimension(){return new a2d.Dimension(this.canvas.width,this.canvas.height)},set dimension(a){this.canvas.setAttribute("width",a.Width),this.canvas.setAttribute("height",a.Height)},get root(){return this.a2dRoot||(console.log("acquire root node"),this.a2dRoot=new a2d.Node,this.frame()),this.a2dRoot},set fullscreen(a){this.a2dFullScreen=a,a&&(this.canvas.requestFullScreen?this.canvas.requestFullScreen():this.canvas.mozRequestFullScreen?this.canvas.mozRequestFullScreen():this.canvas.webkitRequestFullScreen&&this.canvas.webkitRequestFullScreen()),this.onResize()},get fullscreen(){return this.a2dFullScreen},set root(a){this.a2dRoot=a},update:function(){setTimeout(a2d.update,a2d.logicInterval)},frame:function(){a2d.forceClear&&a2d.context&&a2d.context.clearRect(0,0,a2d.dimension.Width,a2d.dimension.Height),a2d.requestFrame(a2d.frame),a2d.root.draw(),a2d.fireEvent("draw")},requestFrame:function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}().bind(window),key:{BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESC:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,ARROW_LEFT:37,ARROW_UP:38,ARROW_RIGHT:39,ARROW_DOWN:40,INSERT:45,DELETE:46,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUM_LOCK:144,SCROLL_LOCK:145}};a2d.Vector=function(a,b){"use strict",this.X=a,this.Y=b,this.clone=function(){return new a2d.Vector(this.X,this.Y)}},a2d.Position=function(a,b){"use strict",a2d.Vector.apply(this,[a,b]),this.scale=function(a){a.Width?(this.X=Math.floor(this.X*a.Width),this.Y=Math.floor(this.Y*a.Height)):(this.X=Math.floor(this.X*a.X),this.Y=Math.floor(this.Y*a.Y))},this.add=function(a){this.X+=a.X,this.Y+=a.Y},this.substract=function(a){this.subtract(a)},this.subtract=function(a){this.X-=a.X,this.Y-=a.Y},this.divide=function(a){this.X=Math.floor(this.X/a.X),this.Y=Math.floor(this.Y/a.Y)},this.isInside=function(a){return this.X>a.topLeft.X&&this.X<a.bottomRight.X&&this.Y>a.topLeft.Y&&this.Y<a.bottomRight.Y?!0:!1},this.is=function(a){return this.X===a.X&&this.Y===a.Y},this.not=function(a){return this.X!==a.X||this.Y!==a.Y},this.distanceTo=function(a){var b=Math.abs(this.X-a.X),c=Math.abs(this.Y-a.Y);return Math.sqrt(Math.pow(b,2)+Math.pow(c,2))},this.clone=function(){return new a2d.Position(this.X,this.Y)}},a2d.Rectangle=function(a,b){"use strict",this.topLeft=a,this.bottomRight=b,this.topRight=new a2d.Position(b.X,a.Y),this.bottomLeft=new a2d.Position(a.X,b.Y),this.add=function(a){this.topLeft.add(a),this.topRight.add(a),this.bottomLeft.add(a),this.bottomRight.add(a)},this.overlaps=function(a){return a.topLeft.isInside(this)||a.bottomRight.isInside(this)||a.topRight.isInside(this)||a.bottomLeft.isInside(this)}},a2d.Dimension=function(a,b){"use strict",this.Width=a,this.Height=b,this.scale=function(a){this.Width=Math.floor(this.Width*a.X),this.Height=Math.floor(this.Height*a.Y)}},a2d.Collection=function(){this.length=0,this.push=function(a){typeof a=="object"&&(a.parent=this),this[this.length]=a,this.length+=1},this.pop=function(){return this.length-=1,this[this.length]},this.remove=function(a){var b=this[a],c;delete this[a];for(c=a+1;c<this.length;c++)this[c-1]=this[c];return this.length-=1,b},this.shift=function(){return this.remove(0)},this.unshift=function(a){var b;for(b=0;b<this.length;b++)this[b+1]=this[b];return this[0]=a,this.length+=1,this.length},this.indexOf=function(a){var b;for(b=0;b<this.length;b++)if(this[b]==a)return b;return-1},this.append=function(a){var b;for(b=0;b<a.length;b++)this.push(a[b])},this.sort=function(a){for(var b=1;b<this.length;b++)if(a(this[b],this[b-1])<0){var c=this[b];this[b]=this[b-1],this[b-1]=c}},this.foreach=function(a){for(var b=0;b<this.length;b++)a(this[b])}},a2d.Events=function(){"use strict";var a=this,b={};this.hasEvent=function(a){return b[a]?!0:!1},this.addEventListener=function(a,c){b[a]||(b[a]=[]),b[a].push(c)},this.emit=function(a,b){this.fireEvent(a,b)},this.on=function(a,b){this.addEventListener(a,b)},this.fireEvent=function(c,d){var e,f="on"+c.charAt(0).toUpperCase()+c.slice(1);if(b[c])for(e=0;e<b[c].length;e++)b[c][e](d);a[f]&&a[f](d)},this.removeEventListener=function(a,c){var d=-1;b[a]&&(d=b[a].indexOf(c),d!=-1&&b[a].splice(d,1))}},a2d.Events.apply(a2d),a2d.Audio=function(){var a=this;this.file=new Audio,this.canPlay={},this.canPlay.mp3=this.file.canPlayType("audio/mpeg"),this.canPlay.ogg=this.file.canPlayType("audio/ogg"),this.canPlay.wav=this.file.canPlayType("audio/wav"),this.channels=[],this.channels.length=8,this.file.addEventListener("canplaythrough",function(){a.audioLoaded=!0,a.onload&&a.onload()}),this.stop=function(){for(var a=0;a<this.channels.length;a++)this.channels[a]&&!this.channels[a].paused&&(this.channels[a].pause(),this.channels[a].currentTime=0)},this.play=function(a){var b=a||!1;if(!a2d.mute&&this.audioLoaded){var c=!1;for(var d=0;d<this.channels.length;d++){this.channels[d]||(this.channels[d]=new Audio(this.file.src),this.channels[d].paused=!0);if(this.channels[d].currentTime==0||this.channels[d].ended){this.channels[d].loop=b,this.channels[d].play(),console.log("play: "+this.channels[d].src),c=!0;break}}c||(this.channels[0].pause(),this.channels[0].currentTime=0,this.channels[0].play())}},this.__defineSetter__("src",function(a){var b=a.substr(a.lastIndexOf(".")+1).toLowerCase();this.canPlay[b]?(this.file.src=a,this.file.pause()):(this.audioLoaded=!0,this.onload&&this.onload())})},a2d.Node=function(){"use strict",a2d.Collection.apply(this),a2d.Events.apply(this);var a=this;this.absolute=!1,this.scrollLock=!1,this.opacity=1,this.position=new a2d.Position(0,0),this.offset=new a2d.Position(0,0),this.set=function(a){for(var b in a)this[b]=a[b]},this.__defineGetter__("absolutePosition",function(){if(this.parent){var a=this.parent.absolutePosition.clone();return a.add(this.position),a}return this.position}),this.__defineSetter__("absolutePosition",function(a){if(this.parent){var b=this.parent.absolutePosition.clone();b.subtract(a),this.position=b}else this.position=a}),this.__defineGetter__("absoluteOffset",function(){if(this.parent){var a=this.parent.absoluteOffset.clone();return a.add(this.offset),a}return this.offset}),this.__defineSetter__("absoluteOffset",function(a){if(this.parent){var b=this.parent.absoluteOffset.clone();b.subtract(a),this.offset=b}else this.offset=a}),this.boundingBox=new a2d.Rectangle(new a2d.Position(0,0),new a2d.Position(0,0)),this.hover=!1,this.scale=new a2d.Vector(1,1),this.visible=!0,this.name="Node",this.findNodeAt=function(b){var c=new a2d.Position(b.X,b.Y);this.offset&&!this.absolute&&c.add(this.offset);for(var d=a.length-1;d>=0;d--){var e=a[d].findNodeAt(c);if(e)return e}return c.isInside(a.boundingBox)&&(a.hasEvent("click")||a.hasEvent("mousedown"))?a:null},this.draw=function(){var a,b=a2d.mousePosition?new a2d.Position(a2d.mousePosition.X,a2d.mousePosition.Y):new a2d.Position(0,0);b&&b.isInside(this.boundingBox)?this.hover||(this.fireEvent("mouseover"),this.fireEvent("hover"),this.hover=!0):this.hover&&(this.fireEvent("mouseout"),this.hover=!1);if(this.visible)for(a=0;a<this.length;a++)this[a].draw();this.fireEvent("draw"),a2d.drawCounter!==undefined&&a2d.drawCounter++}},a2d.Tile=function(a,b){"use strict",a2d.Node.apply(this);var c=0,d=new a2d.Position(0,0),e=!1,f=this,g=this.draw.bind(this),h=function(){a.width<a.height?f.tileSize=new a2d.Dimension(a.width,a.width):f.tileSize=new a2d.Dimension(a.height,a.height)},i=function(){var a=f.absolutePosition.X+f.offset.X,b=f.absolutePosition.Y+f.offset.Y;f.boundingBox.topLeft.X=a-f.tileSize.Width/2,f.boundingBox.topLeft.Y=b-f.tileSize.Height/2,f.boundingBox.bottomRight.X=a+f.tileSize.Width/2,f.boundingBox.bottomRight.Y=b+f.tileSize.Height/2,f.boundingBox.topRight.X=a+f.tileSize.Width/2,f.boundingBox.topRight.Y=b-f.tileSize.Height/2,f.boundingBox.bottomLeft.X=a-f.tileSize.Width/2,f.boundingBox.bottomLeft.Y=b+f.tileSize.Height/2};this.image=a,this.tile=0,this.loop=!1,this.range=new a2d.Vector(0,0),this.fps=8,this.angle=0,this.tileSize=new a2d.Dimension(0,0),this.position=new a2d.Position(0,0),this.opacity=1,this.scrollLock=!1,this.setTile=function(a){this.tile=a,a!==-1&&(d.Y=parseInt(a/(this.image.width/this.tileSize.Width),10)*this.tileSize.Height,d.X=parseInt(a%(this.image.width/this.tileSize.Width),10)*this.tileSize.Width)},this.__defineGetter__("animated",function(){return c!==0}),this.frameLoop=function(a,b){this.range=a,this.loop=b,e=!0,c=(new Date).getTime()},this.stop=function(a){this.setTile(a||0),c=0},this.draw=function(a,b){var h=a||a2d.canvas,j=h.getContext("2d");i();if(c!==0){var k=(new Date).getTime()-c,l=this.range.Y-this.range.X,m=l/this.fps*1e3;if(k>m)this.loop?(c=(new Date).getTime(),e=!e):(c=0,this.fireEvent("animationend"));else{var n=1e3/this.fps;e?this.setTile(Math.floor(k/n)+this.range.X):this.setTile(this.range.Y-Math.floor(k/n))}}if(this.visible){var o=this.absolutePosition.clone();f.absoluteOffset&&o.add(f.absoluteOffset),b&&o.scale(b),j.save(),j.translate(o.X,o.Y),j.rotate(this.angle),b?j.scale(b.X,b.Y):j.scale(this.scale.X,this.scale.Y),j.globalAlpha=this.opacity,j.drawImage(this.image,d.X,d.Y,this.tileSize.Width,this.tileSize.Height,-(this.tileSize.Width/2),-(this.tileSize.Height/2),this.tileSize.Width,this.tileSize.Height),j.restore()}g()},h(),b&&this.set(b),this.setTile(this.tile)},a2d.TileGrid=function(a){"use strict",a2d.Node.apply(this);var b=this,c=this.draw.bind(this),d=this.fireEvent.bind(this),e=[],f=new a2d.Dimension(0,0),g=new a2d.Dimension(0,0),h=null,i=document.createElement("canvas");i.width=a2d.dimension.Width,i.height=a2d.dimension.Height,this.boundingBox=new a2d.Rectangle(new a2d.Position(0,0),new a2d.Position(a2d.dimension.Width,a2d.dimension.Height)),this.offset=new a2d.Position(0,0),this.setData=function(a){var b,c,d=0;g=new a2d.Dimension(a.gridSize[0],a.gridSize[1]),f=new a2d.Dimension(a.tileSize[0],a.tileSize[1]);for(b=0;b<g.Width;b++){e[b]||(e[b]=[]);for(c=0;c<g.Height;c++)e[b][c]=new a2d.Tile(a2d.resources[a.tileSet]),e[b][c].tileSize=f,e[b][c].setTile(a.tiles[d]),e[b][c].parent=this,a.tiles[d]!==-1&&(e[b][c].edit=!0),e[b][c].position=new a2d.Position(b*f.Width+f.Width/2,c*f.Height+f.Height/2),d++}},this.fireEvent=function(a,c){a==="click"&&(c||(c={}),c.tile=b.getTile(a2d.mousePosition),c.tileType=e[c.tile.X][c.tile.Y].tile),d(a,c)},this.getWidth=function(){return g.Width},this.getHeight=function(){return g.Height},this.getTile=function(a){return new a2d.Position(Math.floor(a.X/f.Width),Math.floor(a.Y/f.Height))},this.toPix=function(a){return new a2d.Position(a.X*f.Width+parseInt(f.Width/2,10),a.Y*f.Height+parseInt(f.Height/2,10))},this.getTiles=function(){return e},this.draw=function(){var a,b,d,j;if(this.visible){if(!h||h.not(this.offset)){a2d.forceClear&&i.getContext("2d").clearRect(0,0,a2d.dimension.Width,a2d.dimension.Height),d=this.getTile(this.offset),d.add(new a2d.Position(1,1)),d.scale(new a2d.Position(-1,-1)),j=new a2d.Position(d.X+Math.floor(a2d.dimension.Width/f.Width)+1+1,d.Y+Math.floor(a2d.dimension.Height/f.Height)+1+1),j.X>g.Width&&(j.X=g.Width),j.Y>g.Height&&(j.Y=g.Height),d.X<0&&(d.X=0),d.Y<0&&(d.Y=0);for(a=d.X;a<j.X;a++)for(b=d.Y;b<j.Y;b++)e[a][b].tile!==-1&&e[a][b].draw(i);h=this.offset.clone()}a2d.context.drawImage(i,0,0)}c()},this.visibleArea=function(){return{from:this.getTile(a2d.offset),to:new a2d.Position(fromTile.X+Math.floor(a2d.dimension.Width/f.Width)+1+1,fromTile.Y+Math.floor(a2d.dimension.Height/f.Height)+1+1)}},this.getCache=function(){var a=document.createElement("canvas"),b=a.getContext("2d"),c=f.Width*g.Width,d=f.Height*g.Height;a.width=c,a.height=d;for(var h=0;h<g.Width;h++)for(var i=0;i<g.Height;i++)e[h][i].draw(a);return new a2d.Tile(a)},this.getMini=function(a){var b=document.createElement("canvas"),c=b.getContext("2d"),d=f.Width*g.Width,h=f.Height*g.Height,i=new a2d.Vector(a.Width/d,a.Height/h);b.width=a.Width,b.height=a.Height;for(var j=0;j<g.Width;j++)for(var k=0;k<g.Height;k++)e[j][k].draw(b,i);return new a2d.Tile(b)},a&&this.setData(a)},a2d.IsoGrid=function(a){"use strict",a2d.Node.apply(this);var b=this,c=this.draw.bind(this),d=this.fireEvent.bind(this),e=[],f=new a2d.Dimension(0,0),g=new a2d.Dimension(0,0),h=null,i=document.createElement("canvas");i.width=a2d.dimension.Width,i.height=a2d.dimension.Height,this.boundingBox=new a2d.Rectangle(new a2d.Position(0,0),new a2d.Position(a2d.dimension.Width,a2d.dimension.Height)),this.scrollLock=!0,this.offset=new a2d.Position(0,0),this.dimension=new a2d.Dimension(a2d.dimension.Width,a2d.dimension.Height),this.setData=function(a){var b=0,c=0,d=0;g=new a2d.Dimension(a.gridSize[0],a.gridSize[1]),f=new a2d.Dimension(a.tileSize[0],a.tileSize[1]);for(c=0;c<g.Height;c++)for(b=0;b<g.Width;b++)e[b]||(e[b]=[]),e[b][c]=new a2d.Tile(a2d.resources[a.tileSet]),e[b][c].tileSize=f,e[b][c].setTile(a.tiles[d]),e[b][c].parent=this,a.tiles[d]!==-1&&(e[b][c].edit=!0),e[b][c].position=new a2d.Position(b*f.Width/2-c*(f.Width/2),c*f.Height/2+b*f.Height/2),d++},this.getTileSize=function(){return f},this.fireEvent=function(a,c){a==="click"&&(c||(c={}),c.tile=b.getTile(a2d.mousePosition),c.tileType=e[c.tile.X][c.tile.Y].tile),d(a,c)},this.getWidth=function(){return g.Width},this.getHeight=function(){return g.Height},this.getTile=function(a){var b=a.clone();return b.X=b.X/f.Width,b.Y=b.Y/f.Height,b=a2d.ScreenToGame(b),game.chrome?b.Y-=.5:b.X-=.5,b=b.floor(),b},this.toPix=function(a){return new a2d.Position(a.X*f.Width+parseInt(f.Width/2,10),a.Y*f.Height+parseInt(f.Height/2,10))},this.getTiles=function(){return e},this.draw=function(){var a,d,f,j;if(this.visible){i.width=b.dimension.Width,i.height=b.dimension.Height,f=new a2d.Position(0,0),j=new a2d.Position(g.Width,g.Height),j.X>g.Width&&(j.X=g.Width),j.Y>g.Height&&(j.Y=g.Height),f.X<0&&(f.X=0),f.Y<0&&(f.Y=0);for(d=f.Y;d<j.Y;d++)for(a=f.X;a<j.X;a++)e[a][d].tile!==-1&&e[a][d].draw(i);h=b.offset.clone(),a2d.context.drawImage(i,b.position.X,b.position.Y)}c()},this.visibleArea=function(){return{from:this.getTile(b.offset),to:new a2d.Position(fromTile.X+Math.floor(a2d.dimension.Width/f.Width)+1+1,fromTile.Y+Math.floor(a2d.dimension.Height/f.Height)+1+1)}},this.getMini=function(a){var b=document.createElement("canvas"),c=b.getContext("2d"),d=f.Width*g.Width,h=f.Height*g.Height,i=new a2d.Vector(a.Width/d,a.Height/h);b.width=a.Width,b.height=a.Height;for(var j=0;j<g.Width;j++)for(var k=0;k<g.Height;k++)e[j][k].draw(b,i);return new a2d.Tile(b)},a&&this.setData(a)},a2d.Particles=function(a){a2d.Node.apply(this);var b=this,c=a.lifeTime||1e3,d=a.speed||200,e=a.frequency||300,f=a.rotateSpeed||.01,g=a.startScale||1,h=a.endScale||0,i=a.image,j=0,k=0,l=this.draw.bind(this);b.position=a.position||new a2d.Position(0,0),this.draw=function(){var a=(new Date).getTime();j===0&&(j=a),k===0&&(k=a);var m=a-j,n=Math.floor(m/(1e3/e));!(n>0);for(var o=0;o<n;o++){var p=new a2d.Tile(i),q=Math.random()*6.28;p.birth=(new Date).getTime(),p.position=new a2d.Position(b.position.X,b.position.Y),b.relative&&p.position.add(this.parent.position),p.dir=new a2d.Vector(Math.cos(q),Math.sin(q)),j=p.birth,b.push(p)}for(var o=b.length-1;o>=0;--o){var r=a-b[o].birth,s=g-h;b[o].opacity=1-r/c,b[o].angle=r/c*360*f,b[o].scale.X=g-r/c*s,b[o].scale.Y=g-r/c*s,b[o].position.X+=b[o].dir.X*d*((a-k)/1e3),b[o].position.Y+=b[o].dir.Y*d*((a-k)/1e3),r>c&&b.remove(o)}k=a,l()}},a2d.Label=function(a,b){"use strict",a2d.Node.apply(this);var c=this,d=this.draw.bind(this),e="",f="21px Arial",g=new a2d.Dimension(0,0),h=function(){var a=c.position.X,b=c.position.Y;a<0&&(a+=a2d.dimension.Width),b<0&&(b+=a2d.dimension.Height),c.boundingBox.topLeft.X=a-g.Width/2,c.boundingBox.topLeft.Y=b-g.Height/2,c.boundingBox.bottomRight.X=a+g.Width/2,c.boundingBox.bottomRight.Y=b+g.Height/2,c.boundingBox.topRight.X=a+g.Width/2,c.boundingBox.topRight.Y=b-g.Height/2,c.boundingBox.bottomLeft.X=a-g.Width/2,c.boundingBox.bottomLeft.Y=b+g.Height/2};this.__defineSetter__("text",function(a){e=a,a2d.context.font=c.font,g.Width=a2d.context.measureText(e).width,g.Height=a2d.context.measureText("m").width}),this.__defineGetter__("text",function(){return e}),this.__defineSetter__("font",function(a){f=a,a2d.context.font=f,g.Width=a2d.context.measureText(e).width,g.Height=a2d.context.measureText("m").width}),this.__defineGetter__("font",function(){return f}),this.text=a,this.border={width:0,color:"black"},this.color="#000",this.textAlign="center",this.draw=function(){if(c.visible){h();var a=c.absolutePosition.clone();c.scrollLock&&a.X<0&&(a.X+=a2d.dimension.Width),c.scrollLock&&a.Y<0&&(a.Y+=a2d.dimension.Height),a.add(this.offset),this.relative&&a.add(this.parent.position),a2d.context.globalAlpha=this.opacity,a2d.context.textAlign=this.textAlign,a2d.context.textBaseline="middle",a2d.context.font=c.font,a2d.context.fillStyle=c.color,this.border.width!==0&&(a2d.context.lineWidth=this.border.width,a2d.context.strokeStyle=this.border.color,a2d.context.strokeText(this.text,a.X,a.Y)),a2d.context.fillText(this.text,a.X,a.Y),d()}},b&&this.set(b)}