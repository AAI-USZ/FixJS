function(c,d){b.screen_feature(d,function(d){d&&bean.fire(b,"on",{parent:j(),data:d,formatter:a.formatter().format,e:c})})},b.screen_feature=function(b,c){var d=o(b);d||c(null),a.getGrid(d.src,function(a,e){if(a||!e)return c(null);var f=e.tileFeature(b.x,b.y,d);c(f)})},b.attach=function(a){return arguments.length?(h=a,b):h},b.detach=function(a){return arguments.length?(i=a,b):i},b.map=function(a){return arguments.length?(k=a,h&&h(k),bean.add(j(),m),bean.add(j(),"touchstart",r),b):k},b.grid=function(a){return arguments.length?(g=a,b):g},b.remove=function(a){return i&&i(k),bean.remove(j(),m),bean.fire(b,"remove"),b},b.tilejson=function(c){return arguments.length?(a.tilejson(c),b):a.tilejson()},b.formatter=function(){return a.formatter()},b.on=function(a,c){return bean.add(b,a,c),b},b.off=function(a,c){return bean.remove(b,a,c),b},b.gridmanager=function(c){return arguments.length?(a=c,b):a},b.parent=function(a){return j=a,b},b};var wax=wax||{};wax.legend=function(){var a,b={},c;return b.element=function(){return c},b.content=function(c){return arguments.length?(a.innerHTML=wax.u.sanitize(c),a.style.display="block",a.innerHTML===""&&(a.style.display="none"),b):a.innerHTML},b.add=function(){return c=document.createElement("div"),c.className="map-legends",a=c.appendChild(document.createElement("div")),a.className="map-legend",a.style.display="none",b},b.add()};var wax=wax||{};wax.location=function(){function b(a){console.log(a);if(a.e.type==="mousemove"||!a.e.type)return;var b=a.formatter({format:"location"},a.data);b&&(window.location.href=b)}var a={};return a.events=function(){return{on:b}},a};var wax=wax||{};wax.movetip={},wax.movetip=function(){function g(a){var b=wax.u.eventoffset(a);c.height+b.y>d.top+d.height&&d.height>c.height&&(b.y-=c.height,e.className+=" flip-y"),c.width+b.x>d.left+d.width&&(b.x-=c.width,e.className+=" flip-x"),e.style.left=b.x+"px",e.style.top=b.y+"px"}function h(a){var b=document.createElement("div");return b.className="map-tooltip map-tooltip-0",b.innerHTML=a,b}function i(){e&&(e.parentNode.removeChild(e),e=null)}function j(b){var j;if(a)return;if(b.e.type==="mousemove"||!b.e.type){j=b.formatter({format:"teaser"},b.data);if(!j)return;i(),f.style.cursor="pointer",e=document.body.appendChild(h(j))}else{j=b.formatter({format:"teaser"},b.data);if(!j)return;i();var k=document.body.appendChild(h(j));k.className+=" map-popup";var l=k.appendChild(document.createElement("a"));l.href="#close",l.className="close",l.innerHTML="Close",a=!0,e=k,c=wax.u.offset(e),d=wax.u.offset(f),g(b.e),bean.add(l,"click touchend",function(b){b.stop(),i(),a=!1})}e&&(c=wax.u.offset(e),d=wax.u.offset(f),g(b.e))}function k(){f.style.cursor="default",a||i()}var a=!1,b={},c,d,e,f;return b.parent=function(a){return arguments.length?(f=a,b):f},b.events=function(){return{on:j,off:k}},b};var wax=wax||{};wax.request={cache:{},locks:{},promises:{},get:function(a,b){if(this.cache[a])return b(this.cache[a][0],this.cache[a][1]);this.promises[a]=this.promises[a]||[],this.promises[a].push(b);if(this.locks[a])return;var c=this;this.locks[a]=!0,reqwest({url:a+(~a.indexOf("?")?"&":"?")+"callback=grid",type:"jsonp",jsonpCallback:"callback",success:function(b){c.locks[a]=!1,c.cache[a]=[null,b];for(var d=0;d<c.promises[a].length;d++)c.promises[a][d](c.cache[a][0],c.cache[a][1])},error:function(b){c.locks[a]=!1,c.cache[a]=[b,null];for(var d=0;d<c.promises[a].length;d++)c.promises[a][d](c.cache[a][0],c.cache[a][1])}})}},wax.template=function(a){var b={};return b.format=function(b,c){var d={};for(var e in c)d[e]=c[e];return b.format&&(d["__"+b.format+"__"]=!0),wax.u.sanitize(Mustache.to_html(a,d))},b};if(!wax)var wax={};wax.tilejson=function(a,b){reqwest({url:a+(~a.indexOf("?")?"&":"?")+"callback=grid",type:"jsonp",jsonpCallback:"callback",success:b,error:b})};var wax=wax||{};wax.tooltip={},wax.tooltip=function(){function h(a){var b=document.createElement("div");return b.className="map-tooltip map-tooltip-0",b.innerHTML=a,b}function i(){this.parentNode&&this.parentNode.removeChild(this)}function j(){var a;while(a=d.pop())b&&f?(bean.add(a,f,i),a.className+=" map-fade"):a.parentNode&&a.parentNode.removeChild(a)}function k(b){var c;if(b.e.type==="mousemove"||!b.e.type){if(!a){c=b.content||b.formatter({format:"teaser"},b.data);if(!c||c==e)return;j(),g.style.cursor="pointer",d.push(g.appendChild(h(c))),e=c}}else{c=b.content||b.formatter({format:"full"},b.data);if(!c){b.e.type&&b.e.type.match(/touch/)&&(c=b.content||b.formatter({format:"teaser"},b.data));if(!c)return}j(),g.style.cursor="pointer";var f=g.appendChild(h(c));f.className+=" map-popup";var i=f.appendChild(document.createElement("a"));i.href="#close",i.className="close",i.innerHTML="Close",a=!0,d.push(f),bean.add(i,"touchstart mousedown",function(a){a.stop()}),bean.add(i,"click touchend",function(b){b.stop(),j(),a=!1})}}function l(){g.style.cursor="default",e=null,a||j()}var a=!1,b=!1,c={},d=[],e,f,g;return document.body.style["-webkit-transition"]!==undefined?f="webkitTransitionEnd":document.body.style.MozTransition!==undefined&&(f="transitionend"),c.parent=function(a){return arguments.length?(g=a,c):g},c.animate=function(a){return arguments.length?(b=a,c):b},c.events=function(){return{on:k,off:l}},c};var wax=wax||{};wax.u={offset:function(a){var b=a.offsetWidth||parseInt(a.style.width,10),c=a.offsetHeight||parseInt(a.style.height,10),d=document.body,e=0,f=0,g=function(a){if(a===d||a===document.documentElement)return;e+=a.offsetTop,f+=a.offsetLeft;var b=a.style.transform||a.style.WebkitTransform||a.style.OTransform||a.style.MozTransform||a.style.msTransform;if(b){var c;if(c=b.match(/translate\((.+)px, (.+)px\)/))e+=parseInt(c[2],10),f+=parseInt(c[1],10);else if(c=b.match(/translate3d\((.+)px, (.+)px, (.+)px\)/))e+=parseInt(c[2],10),f+=parseInt(c[1],10);else if(c=b.match(/matrix3d\(([\-\d,\s]+)\)/)){var g=c[1].split(",");e+=parseInt(g[13],10),f+=parseInt(g[12],10)}else if(c=b.match(/matrix\(.+, .+, .+, .+, (.+), (.+)\)/))e+=parseInt(c[2],10),f+=parseInt(c[1],10)}};g(a);try{while(a=a.offsetParent)g(a)}catch(h){}e+=d.offsetTop,f+=d.offsetLeft,e+=d.parentNode.offsetTop,f+=d.parentNode.offsetLeft;var i=document.defaultView?window.getComputedStyle(d.parentNode,null):d.parentNode.currentStyle;return d.parentNode.offsetTop!==parseInt(i.marginTop,10)&&!isNaN(parseInt(i.marginTop,10))&&(e+=parseInt(i.marginTop,10),f+=parseInt(i.marginLeft,10)),{top:e,left:f,height:c,width:b}},$:function(a){return typeof a=="string"?document.getElementById(a):a},indexOf:function(a,b){var c=Array.prototype.indexOf;if(a===null)return-1;var d,e;if(c&&a.indexOf===c)return a.indexOf(b);for(d=0,e=a.length;d<e;d++)if(a[d]===b)return d;return-1},eventoffset:function(a){var b=0,c=0;a||(a=window.event);if(a.pageX||a.pageY)return{x:a.pageX,y:a.pageY};if(a.clientX||a.clientY)return{x:a.clientX,y:a.clientY};if(a.touches&&a.touches.length===1)return{x:a.touches[0].pageX,y:a.touches[0].pageY}},limit:function(a,b,c){var d;return function(){var e=this,f=arguments,g=function(){d=null,a.apply(e,f)};c&&clearTimeout(d);if(c||!d)d=setTimeout(g,b)}},throttle:function(a,b){return this.limit(a,b,!1)},sanitize:function(a){function b(a){if(/^(https?:\/\/|data:image)/.test(a))return a}function c(a){return a}return a?html_sanitize(a,b,c):""}},wax=wax||{},wax.esri=wax.esri||{},wax.esri.attribution=function(a,b){b=b||{};var c,d={};return d.element=function(){return c.element()},d.appendTo=function(a){return wax.u.$(a).appendChild(c.element()),this},d.init=function(){return c=wax.attribution(),c.content(b.attribution),c.element().className="map-attribution map-mm",this},d.init()},wax=wax||{},wax.esri=wax.esri||{},wax.esri.interaction=function(){function e(){a=!0}function f(){if(!a&&b)return b;b=[];for(var d=0;d<c.layerIds.length;d++){var e=c.getLayer(c.layerIds[d]),f=e._div,g=f.getElementsByTagName("img");for(var h=0;h<g.length;h++){var i=wax.u.offset(g[h]);b.push([i.top,i.left,g[h]])}}return b}function g(a){if(!arguments.length)return c;c=a,d=[dojo.connect(c,"onExtentChange",e),dojo.connect(c,"onUpdateEnd",e),dojo.connect(c,"onReposition",e)]}function h(a){for(var b=0;b<d.length;b++)dojo.disconnect(d[b])}var a=!1,b,c,d;return wax.interaction().attach(g).detach(h).parent(function(){return c.root}).grid(f)},dojo.declare("wax.esri.connector",esri.layers.TiledMapServiceLayer,{constructor:function(a){a=a||{},this.options={tiles:a.tiles,minzoom:a.minzoom||0,maxzoom:a.maxzoom||22};var b=20037508.342789;this.spatialReference=new esri.SpatialReference({wkid:3857}),this.initialExtent=new esri.geometry.Extent(-b,-b,b,b,this.spatialReference),this.fullExtent=this.initialExtent;var c=[];for(var d=this.options.minzoom;d<=this.options.maxzoom;d++)c.push({level:d,scale:591657527.591555/Math.pow(2,d),resolution:156543.033928/Math.pow(2,d)});this.tileInfo=new esri.layers.TileInfo({spatialReference:{wkid:"3857"},rows:256,cols:256,origin:{x:-b,y:b},lods:c}),this.loaded=!0,this.onLoad(this)},getTileUrl:function(a,b,c){return this.options.tiles[parseInt(Math.pow(2,a)*b+c,10)%this.options.tiles.length].replace("{z}",a).replace("{x}",c).replace("{y}",b)}