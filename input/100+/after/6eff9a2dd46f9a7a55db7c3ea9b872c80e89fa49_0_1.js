function(a){function b(b,c,d){this.container=b;this.options=c;this.maskId="";this.isOpen=false;this.imageList=[];this.currentImageIndex=0;a.tiSlideshow.interfaces[d]=this;if(this.options.auto)this.open()}b.prototype.open=function(){if(this.isOpen)return;if(!this.beforeOpen())return;this.isOpen=true;this.imageList=[];this.currentImageIndex=0;var b="tiSlideshowExposeMask";while(a("#"+b).length){b+="i"}this.maskId=b;var c='<div id="'+this.maskId+'" class="tiSlideshowExposeMask" style="opacity: '+this.options.opacity+"; background-color: "+this.options.mask+'; "></div>';var d='<div class="tiSlideshowPlaceControl"><div class="tiSlideshowPlaceControlThumbnailsScroll"><div class="tiSlideshowPlaceControlThumbnails"></div></div><a href="#" class="tiSlideshowPlaceControlClose"></a></div>';var e='<div class="tiSlideshowPlace"><div class="tiSlideshowPlaceSlider"><a href="#" class="tiSlideshowPlaceSliderPrevious"></a><a href="#" class="tiSlideshowPlaceSliderNext"></a><div class="tiSlideshowPlaceSliderPicture"></div></div>'+d+"</div>";a("body").append(c);a("body").append(e);if(navigator.appName=="Microsoft Internet Explorer"){a(".tiSlideshowPlaceControl").css("border","1px solid white")}var f=this;a(f.container).children("img").each(function(){var b=a(this).attr("src");f.imageList.push(b);var c='<a href="#" class="tiSlideshowPlaceControlThumbnailsThumbnail"><img src="'+f.getThumbnailSrc(b)+'" alt="thumbnail" /></a>';a(".tiSlideshowPlaceControlThumbnails").append(c)});f.initThumbnailsEvent();f.currentImageIndex=f.options.beginIndex;if(f.currentImageIndex>=0&&parseInt(f.currentImageIndex)<parseInt(f.imageList.length)){this.showCurrentImage()}else if(f.imageList.length>0){f.currentImageIndex=0;f.showCurrentImage()}this.changeOptions();a(window).scrollTop(0);a(".tiSlideshowExposeMask").show();a(".tiSlideshowPlace").show();this.onOpen()};b.prototype.close=function(){if(!this.isOpen)return;if(!this.beforeClose())return;a(".tiSlideshowExposeMask").remove();a(".tiSlideshowPlace").remove();a("body").unbind("touchmove",a.tiSlideshow.preventTouchmove);this.isOpen=false;this.onClose()};b.prototype.showCurrentImage=function(b){var c=this;a(".tiSlideshowPlaceSliderPicture").html('<img src="'+c.imageList[c.currentImageIndex]+'" alt="picture" style="display: none;"/>');a(".tiSlideshowPlaceSliderPicture img").load(function(){a(".tiSlideshowPlaceSliderPicture img").data("originalHeight",this.height);a(".tiSlideshowPlaceSliderPicture img").data("originalWidth",this.width);a.tiSlideshow.adjustSize();a(".tiSlideshowPlaceSliderPicture img").show();a(".tiSlideshowPlaceControlThumbnailsSelected").removeClass("tiSlideshowPlaceControlThumbnailsSelected");a(".tiSlideshowPlaceControlThumbnails .tiSlideshowPlaceControlThumbnailsThumbnail:eq("+c.currentImageIndex+")").addClass("tiSlideshowPlaceControlThumbnailsSelected");if(b)b()})};b.prototype.changeOptions=function(b){var c=this;this.options=a.extend({},this.options,b);a("#"+this.maskId).css("background-color",this.options.mask);a("#"+this.maskId).css("opacity",this.options.opacity);if(this.options.tactile){a(".tiSlideshowPlaceControlThumbnailsThumbnail").each(function(){a(this).replaceWith('<span class="tiSlideshowPlaceControlThumbnailsThumbnail">'+a(this).html()+"</span>")});a(".tiSlideshowPlaceControlClose").replaceWith('<span class="tiSlideshowPlaceControlClose"></span>');a(".tiSlideshowPlaceSlider .tiSlideshowPlaceSliderPrevious").replaceWith('<span class="tiSlideshowPlaceSliderPrevious"></span>');a(".tiSlideshowPlaceSlider .tiSlideshowPlaceSliderNext").replaceWith('<span class="tiSlideshowPlaceSliderNext"></span>');a("body").bind("touchmove",a.tiSlideshow.preventTouchmove)}else{a(".tiSlideshowPlaceControlThumbnailsThumbnail").each(function(){a(this).replaceWith('<a href="#" class="tiSlideshowPlaceControlThumbnailsThumbnail">'+a(this).html()+"</a>")});a(".tiSlideshowPlaceControlClose").replaceWith('<a href="#" class="tiSlideshowPlaceControlClose"></a>');a(".tiSlideshowPlaceSlider .tiSlideshowPlaceSliderPrevious").replaceWith('<a href="#" class="tiSlideshowPlaceSliderPrevious"></a>');a(".tiSlideshowPlaceSlider .tiSlideshowPlaceSliderNext").replaceWith('<a href="#" class="tiSlideshowPlaceSliderNext"></a>');a("body").unbind("touchmove",a.tiSlideshow.preventTouchmove)}a(".tiSlideshowPlaceSliderPrevious").click(function(){c.previous();return false});a(".tiSlideshowPlaceSliderNext").click(function(){c.next();return false});a(".tiSlideshowPlaceControlClose").click(function(){c.close();return false});c.initThumbnailsEvent();if(this.options.closeButton)a(".tiSlideshowPlaceControlClose").width(100);else a(".tiSlideshowPlaceControlClose").width(0);if(this.options.slideButtons){a(".tiSlideshowPlaceSliderPrevious, .tiSlideshowPlaceSliderNext").show()}else a(".tiSlideshowPlaceSliderPrevious, .tiSlideshowPlaceSliderNext").hide();if(this.options.slideButtons){if(this.imageList.length==0){a(".tiSlideshowPlaceSliderPrevious, .tiSlideshowPlaceSliderNext").hide()}else if(this.options.infiniteSlide){if(this.currentImageIndex==0)a(".tiSlideshowPlaceSliderPrevious").show();if(this.currentImageIndex==this.imageList.length-1)a(".tiSlideshowPlaceSliderNext").show()}else{if(this.currentImageIndex==0)a(".tiSlideshowPlaceSliderPrevious").hide();else a(".tiSlideshowPlaceSliderPrevious").show();if(this.currentImageIndex==this.imageList.length-1)a(".tiSlideshowPlaceSliderNext").hide();else a(".tiSlideshowPlaceSliderNext").show()}}if(this.options.thumbnails){a(".tiSlideshowPlaceControlThumbnailsScroll").show()}else{a(".tiSlideshowPlaceControlThumbnailsScroll").hide()}a.tiSlideshow.adjustSize()};b.prototype.next=function(){var b=this;var c=b.currentImageIndex;var d=parseInt(b.currentImageIndex)+1;if(b.options.infiniteSlide){if(d>=b.imageList.length)d=0}if(d<parseInt(b.imageList.length)&&d>=0){if(!this.beforeSlide(b.currentImageIndex,d))return;b.currentImageIndex=d;if(this.options.slideButtons){if(this.options.infiniteSlide){if(this.currentImageIndex==0)a(".tiSlideshowPlaceSliderPrevious").show();if(this.currentImageIndex==this.imageList.length-1)a(".tiSlideshowPlaceSliderNext").show()}else{if(this.currentImageIndex==0)a(".tiSlideshowPlaceSliderPrevious").hide();else a(".tiSlideshowPlaceSliderPrevious").show();if(this.currentImageIndex==this.imageList.length-1)a(".tiSlideshowPlaceSliderNext").hide();else a(".tiSlideshowPlaceSliderNext").show()}}this.showCurrentImage(function(){b.onSlide(c,b.currentImageIndex)})}};b.prototype.previous=function(){var b=this;var c=b.currentImageIndex;var d=parseInt(b.currentImageIndex)-1;if(b.options.infiniteSlide){if(d<0)d=b.imageList.length-1}if(d<parseInt(b.imageList.length)&&d>=0){if(!b.beforeSlide(b.currentImageIndex,d))return;b.currentImageIndex=d;if(this.options.slideButtons){if(this.options.infiniteSlide){if(this.currentImageIndex==0)a(".tiSlideshowPlaceSliderPrevious").show();if(this.currentImageIndex==this.imageList.length-1)a(".tiSlideshowPlaceSliderNext").show()}else{if(this.currentImageIndex==0)a(".tiSlideshowPlaceSliderPrevious").hide();else a(".tiSlideshowPlaceSliderPrevious").show();if(this.currentImageIndex==this.imageList.length-1)a(".tiSlideshowPlaceSliderNext").hide();else a(".tiSlideshowPlaceSliderNext").show()}}this.showCurrentImage(function(){b.onSlide(c,b.currentImageIndex)})}};b.prototype.initThumbnailsEvent=function(){var b=this;a(".tiSlideshowPlaceControlThumbnails .tiSlideshowPlaceControlThumbnailsThumbnail img").load(function(){a(this).data("originalHeight",this.height);a(this).data("originalWidth",this.width);a.tiSlideshow.adjustSize()});a(".tiSlideshowPlaceControlThumbnails .tiSlideshowPlaceControlThumbnailsThumbnail:eq("+b.currentImageIndex+")").addClass("tiSlideshowPlaceControlThumbnailsSelected");a(".tiSlideshowPlaceControlThumbnailsThumbnail").click(function(){var c=a(this).index()-b.currentImageIndex;while(c){if(c>0){b.next();c--}else{b.previous();c++}}return false});var c=0;a(".tiSlideshowPlaceControlThumbnailsThumbnail").each(function(){c+=a(this).outerWidth(true)});a(".tiSlideshowPlaceControlThumbnails").width(c);if(b.options.tactile){a(".tiSlideshowPlaceControlThumbnails").unbind("touchmove");a(".tiSlideshowPlaceControlThumbnailsScroll").bind("touchmove",function(c){var d=c.originalEvent.touches[0].pageX;if(b.lastTouchX>0){var e=b.lastTouchX-d;var f=a(".tiSlideshowPlaceControlThumbnailsScroll").scrollLeft();a(".tiSlideshowPlaceControlThumbnailsScroll").scrollLeft(f+e)}b.lastTouchX=d});a(".tiSlideshowPlaceControlThumbnailsScroll").unbind("touchstart");a(".tiSlideshowPlaceControlThumbnailsScroll").bind("touchstart",function(a){b.lastTouchX=0})}};b.prototype.getThumbnailSrc=function(a){var b;var c="";if(a.indexOf("/")>=0){b=a.split("/");b.pop();b=b.join("/");if(b[b.length-1]!="/")b=b+"/";c=b}var d=a;if(a.indexOf("/")>=0){b=a.split("/");d=b[b.length-1]}var e=d;if(d.indexOf(".")>=0){b=d.split(".");b.pop();e=b.join()}var f="";if(d.indexOf(".")>=0){b=d.split(".");f="."+b[b.length-1]}var g=this.options.thumbnailName;var h=new RegExp("(%PATH%)","g");g=g.replace(h,c);h=new RegExp("(%FULL_NAME%)","g");g=g.replace(h,d);h=new RegExp("(%NAME%)","g");g=g.replace(h,e);h=new RegExp("(%EXT%)","g");g=g.replace(h,f);return g},b.prototype.beforeOpen=function(){var b=a.proxy(this.options.beforeOpen,this.container);var c=b();if(c==0||c==false)return false;return true};b.prototype.onOpen=function(){var b=a.proxy(this.options.onOpen,this.container);var c=b();if(c==0||c==false)return false;return true};b.prototype.beforeClose=function(){var b=a.proxy(this.options.beforeClose,this.container);var c=b();if(c==0||c==false)return false;return true};b.prototype.onClose=function(){var b=a.proxy(this.options.onClose,this.container);var c=b();if(c==0||c==false)return false;return true};b.prototype.beforeSlide=function(b,c){var d=a.proxy(this.options.beforeSlide,this.container);var e=d(b,c);if(e==0||e==false)return false;return true};b.prototype.onSlide=function(b,c){var d=a.proxy(this.options.onSlide,this.container);var e=d(b,c);if(e==0||e==false)return false;return true};a.tiSlideshow={name:"tiSlideshow",author:"Emeric Kasbarian",version:"0.0.1",interfaces:[],options:{auto:false,mask:"#000",opacity:.9,closeButton:true,slideButtons:true,infiniteSlide:false,thumbnails:true,tactile:false,beginIndex:0,thumbnailName:"%PATH%%FULL_NAME%",beforeOpen:function(){},onOpen:function(){},beforeClose:function(){},onClose:function(){},beforeSlide:function(){},onSlide:function(){}},tiSlideshow:function(c){var d=a.extend({},a.tiSlideshow.options,c);var e;return this.each(function(){if(typeof c=="string"){if(a(this).data("tiSlideshow")){e=a.tiSlideshow.interfaces[a(this).data("id")];if(c=="open")e.open();if(c=="close")e.close();if(c=="next")e.next();if(c=="previous")e.previous()}}else{if(a(this).data("tiSlideshow")){a.tiSlideshow.interfaces[a(this).data("id")].changeOptions(c);if(a.tiSlideshow.interfaces[a(this).data("id")].options.auto)a(this).tiSlideshow("open")}else{var f=a.tiSlideshow.interfaces.length;a(this).data("tiSlideshow",true);a(this).data("id",f);new b(a(this),d,f)}}})},retrieveOpenedTiSlideshow:function(){if(!a(".tiSlideshowExposeMask").length)return null;var b=a(".tiSlideshowExposeMask").attr("id");for(var c in a.tiSlideshow.interfaces){if(a.tiSlideshow.interfaces[c].maskId==b)return a.tiSlideshow.interfaces[c]}return null},adjustSize:function(){var b=a.tiSlideshow.retrieveOpenedTiSlideshow();if(!b)return;var c=a(window).height();var d=a(window).width();if(c-100>0)a(".tiSlideshowPlaceSlider").height(c-100);else a(".tiSlideshowPlaceSlider").height(0);var e=parseInt((a(".tiSlideshowPlaceSlider").height()-a(".tiSlideshowPlaceSliderPrevious").height())/2);var f=parseInt((a(".tiSlideshowPlaceSlider").height()-a(".tiSlideshowPlaceSliderNext").height())/2);a(".tiSlideshowPlaceSliderPrevious").css("top",e+"px");a(".tiSlideshowPlaceSliderNext").css("top",f+"px");if(a(".tiSlideshowPlaceControlThumbnailsScroll").data("jsp"))a(".tiSlideshowPlaceControlThumbnailsScroll").data("jsp").destroy();if(d-100>0){a(".tiSlideshowPlaceControlThumbnailsScroll").width(d-100)}else a(".tiSlideshowPlaceControlThumbnailsScroll").width(0);a(".tiSlideshowPlaceControlThumbnailsThumbnail").each(function(){var b=a(this).height();var c=a(this).width();if(a(this).find("img").data("originalHeight")&&a(this).find("img").data("originalWidth")){var d=a(this).find("img").data("originalHeight");var e=a(this).find("img").data("originalWidth");if(d>b||e>c){if(d>b){e=e*b/d;d=b}if(e>c){d=d*c/e;e=c}a(this).find("img").height(d);a(this).find("img").width(e);var f=parseInt((b-d)/2);if(f<0)f=0;a(this).find("img").css("margin-top",f+"px")}}});if(!a(".tiSlideshowPlaceControlThumbnailsScroll").data("jsp")){if(a.fn.jScrollPane)a(".tiSlideshowPlaceControlThumbnailsScroll").jScrollPane()}else{a(".tiSlideshowPlaceControlThumbnailsScroll").data("jsp").reinitialise()}var g=parseInt(a(".tiSlideshowPlaceSlider").height());var h=parseInt(a(".tiSlideshowPlaceSlider").width());if(!a(".tiSlideshowPlaceSliderPicture img").data("originalHeight")||!a(".tiSlideshowPlaceSliderPicture img").data("originalWidth")){return}var i=parseInt(a(".tiSlideshowPlaceSliderPicture img").data("originalHeight"));var j=parseInt(a(".tiSlideshowPlaceSliderPicture img").data("originalWidth"));a(".tiSlideshowPlaceSliderPicture img").css("margin-top","0px");if(i>g||j>h){if(i>g){j=j*g/i;i=g}if(j>h){i=i*h/j;j=h}}a(".tiSlideshowPlaceSliderPicture img").height(i);a(".tiSlideshowPlaceSliderPicture img").width(j);var k=parseInt((g-i)/2);if(k<0)k=0;a(".tiSlideshowPlaceSliderPicture img").css("margin-top",k+"px")},preventTouchmove:function(a){a.preventDefault()}};a.fn.tiSlideshow=a.tiSlideshow.tiSlideshow;a(window).resize(a.tiSlideshow.adjustSize)}