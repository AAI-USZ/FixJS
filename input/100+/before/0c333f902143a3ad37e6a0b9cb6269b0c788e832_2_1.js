function(t){if((!t||!t.runWithoutWysiwygSupport)&&!e.sceditor.isWysiwygSupported())return;return this.each(function(){new e.sceditor(this,t)})}})(jQuery,window,document),function(e){"use strict";e.sceditorBBCodePlugin=function(t,n){var r=this,i,s,o,u,a,f,l,c,h;r.bbcodes=e.sceditorBBCodePlugin.bbcodes;var p={},d={},v={ul:["li"],ol:["li"],table:["tr"],tr:["td","th"],code:["br","p","div"],youtube:[]};i=function(){e.data(t,"sceditorbbcode",r),r.options=e.extend({},e.sceditor.defaultOptions,n),s(),new e.sceditor(t,e.extend({},r.options,{getHtmlHandler:r.getHtmlHandler,getTextHandler:r.getTextHandler,commands:h()}))},h=function(){var t={bold:{txtExec:["[b]","[/b]"]},italic:{txtExec:["[i]","[/i]"]},underline:{txtExec:["[u]","[/u]"]},strike:{txtExec:["[s]","[/s]"]},subscript:{txtExec:["[sub]","[/sub]"]},superscript:{txtExec:["[sup]","[/sup]"]},left:{txtExec:["[left]","[/left]"]},center:{txtExec:["[center]","[/center]"]},right:{txtExec:["[right]","[/right]"]},justify:{txtExec:["[justify]","[/justify]"]},font:{txtExec:function(t){var n=this;e.sceditor.command.get("font")._createDropDown(n,t,function(e){n.insertText("[font="+e+"]","[/font]")})}},size:{txtExec:function(t){var n=this;e.sceditor.command.get("size")._createDropDown(n,t,function(e){n.insertText("[size="+e+"]","[/size]")})}},color:{txtExec:function(t){var n=this;e.sceditor.command.get("color")._createDropDown(n,t,function(e){n.insertText("[color="+e+"]","[/color]")})}},bulletlist:{txtExec:["[ul][li]","[/li][/ul]"]},orderedlist:{txtExec:["[ol][li]","[/li][/ol]"]},table:{txtExec:["[table][tr][td]","[/td][/tr][/table]"]},horizontalrule:{txtExec:["[hr]"]},code:{txtExec:["[code]","[/code]"]},image:{txtExec:function(e,t){var n=prompt(this._("Enter the image URL:"),t);n&&this.insertText("[img]"+n+"[/img]")}},email:{txtExec:function(e,t){var n=t&&t.indexOf("@")>-1?null:t,r=prompt(this._("Enter the e-mail address:"),n?"":t),i=prompt(this._("Enter the displayed text:"),n||r)||r;r&&this.insertText("[email="+r+"]"+i+"[/email]")}},link:{txtExec:function(e,t){var n=t&&t.indexOf("http://")>-1?null:t,r=prompt(this._("Enter URL:"),n?"http://":t),i=prompt(this._("Enter the displayed text:"),n||r)||r;r&&this.insertText("[url="+r+"]"+i+"[/url]")}},quote:{txtExec:["[quote]","[/quote]"]},youtube:{txtExec:function(e,t){var n=prompt(this._("Enter the YouTube video URL or ID:"),t);n&&(n.indexOf("://")>-1&&(n=n.replace(/^[^v]+v.(.{11}).*/,"$1")),this.insertText("[youtube]"+n+"[/youtube]"))}},rtl:{txtExec:["[rtl]","[/rtl]"]},ltr:{txtExec:["[ltr]","[/ltr]"]}};return e.extend(!0,{},t,e.sceditor.commands)},s=function(){e.each(r.bbcodes,function(t,n){typeof r.bbcodes[t].tags!="undefined"&&e.each(r.bbcodes[t].tags,function(e,n){var i=!!r.bbcodes[t].isBlock;p[e]=p[e]||{},p[e][i]=p[e][i]||{},p[e][i][t]=n}),typeof r.bbcodes[t].styles!="undefined"&&e.each(r.bbcodes[t].styles,function(e,n){var i=!!r.bbcodes[t].isBlock;d[i]=d[i]||{},d[i][e]=d[i][e]||{},d[i][e][t]=n})})},f=function(t,n){var r=e.camelCase(n),i,s,o;return"text-align"===n?(i=e(t),i.parent().css(n)!==i.css(n)&&i.css("display")==="block"&&!i.is("hr")&&!i.is("th")&&(s=i.css(n)),o=t.style.direction,o&&(/right/i.test(s)&&o==="rtl"||/left/i.test(s)&&o==="ltr")?null:s):t.style?t.style[r]:null},c=function(e){var t=e.childNodes,n=t.length;if(e.nodeValue)return!1;if(t.length===0||t.length===1&&(/br/i.test(t[0].nodeName)||c(t[0])))return!0;while(n--)if(!c(t[n]))return!1;return!0},o=function(t,n,i){var s,o=t[0].nodeName.toLowerCase();return i=!!i,d[i]?(e.each(d[i],function(i,o){s=f(t[0],i);if(!s||f(t.parent()[0],i)===s)return;e.each(o,function(i,o){if(!n&&!r.bbcodes[i].allowsEmpty&&c(t[0]))return;if(!o||e.inArray(s.toString(),o)>-1)e.isFunction(r.bbcodes[i].format)?n=r.bbcodes[i].format.call(r,t,n):n=a(r.bbcodes[i].format,n)})}),n):n},u=function(t,n,i){var s=t[0].nodeName.toLowerCase();i=!!i,p[s]&&p[s][i]&&e.each(p[s][i],function(i,s){if(!n&&!r.bbcodes[i].allowsEmpty&&c(t[0]))return;if(s){var o=!1;e.each(s,function(n,r){if(!t.attr(n)||r&&e.inArray(t.attr(n),r)<0)return;return o=!0,!1});if(!o)return}e.isFunction(r.bbcodes[i].format)?n=r.bbcodes[i].format.call(r,t,n):n=a(r.bbcodes[i].format,n)});if(i&&/^(br|div|p)$/.test(s)){var o=t[0].parentNode.childNodes;("br"!==s||o.length!==1)&&("br"!==s||o[o.length-1]!==t[0])&&(n+="\n"),"br"!==s&&!e.sceditor.dom.isInline(t.parent()[0])&&t[0].previousSibling&&t[0].previousSibling.nodeType===3&&(n="\n"+n)}return n},a=function(){var e=arguments;return e[0].replace(/\{(\d+)\}/g,function(t,n){return typeof e[n-0+1]!="undefined"?e[n-0+1]:"{"+n+"}"})},r.stripQuotes=function(e){return e.replace(/^(["'])(.*?)\1$/,"$2")},r.getHtmlHandler=function(t,n){return e.sceditor.dom.removeWhiteSpace(n[0]),e.trim(r.elementToBbcode(n))},r.elementToBbcode=function(t){return function n(t,r){var i="";return e.sceditor.dom.traverse(t,function(t){var s=e(t),a="",f=t.nodeName.toLowerCase(),l=v[f],c=!0;typeof r=="object"&&(c=e.inArray(f,r)>-1,c||(l=r));if(t.nodeType!==3){if(s.hasClass("sceditor-ignore"))return;f!=="iframe"&&(a=n(t,l)),c?(s.is("code")||(a=o(s,a),a=u(s,a),a=o(s,a,!0)),i+=u(s,a,!0)):i+=a}else t.wholeText&&(!t.previousSibling||t.previousSibling.nodeType!==3)?e(t).parents("code").length===0?i+=t.wholeText.replace(/ +/g," "):i+=t.wholeText:t.wholeText||(i+=t.nodeValue)},!1,!0),i}(t.get(0))},r.getTextHandler=function(t,n){var i,s,o=/\[([^\[\s=]+)(?:([^\[\]]+))?\]((?:[\s\S](?!\[\1))*?)\[\/(\1)\]/g,u=/(\S+)=((?:(?:(["'])(?:\\\3|[^\3])*?\3))|(?:[^'"\s]+))/g;s=function(t,n,i,s){var o={},f;n=n.toLowerCase();if(i){i=e.trim(i);if(i.charAt(0)==="="&&i.split("=").length-1<=1||n==="url")o.defaultattr=r.stripQuotes(i.substr(1));else{i.charAt(0)==="="&&(i="defaultattr"+i);while(f=u.exec(i))o[f[1].toLowerCase()]=r.stripQuotes(f[2])}}return r.bbcodes[n]?e.isFunction(r.bbcodes[n].html)?r.bbcodes[n].html.call(r,n,o,s):a(r.bbcodes[n].html,s):t},t=t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r/g,"").replace(/(\[\/?(?:left|center|right|justify|align|rtl|ltr)\])\n/g,"$1").replace(/\n/g,"<br />");while(t!==i)i=t,t=t.replace(o,s);return t=t.replace(/\[hr\]/gi,"<hr>").replace(/\[\*\]/gi,"<li>"),t=t.replace(/ {2}(?=([^<\>]*?<|[^<\>]*?$))/g," &nbsp;"),l(t,n)},l=function(t,n){var r=document,i=r.createDocumentFragment(),s=r.createElement("div"),o=r.createElement("div"),u,a,f,l;e(o).hide().appendTo(r.body),o.innerHTML=t,a=o.firstChild;while(a){f=a.nextSibling,l=a.nodeName.toLowerCase();if(a.nodeType===1&&!e.sceditor.dom.isInline(a)||l==="br"){if(i.childNodes.length>0||l==="br")u=r.createElement("div"),u.appendChild(i),l==="br"&&(!e.sceditor.ie||e.sceditor.ie<9)&&u.appendChild(r.createElement("br")),s.appendChild(u),i=r.createDocumentFragment();l!=="br"&&s.appendChild(a)}else i.appendChild(a);a=f}i.childNodes.length>0&&(u=r.createElement("div"),u.appendChild(i),s.appendChild(u));if(n){a=s.firstChild;if(a&&a.nodeName.toLowerCase()==="div"){while(f=a.firstChild)s.insertBefore(f,a);e.sceditor.ie>=9&&s.insertBefore(r.createElement("br"),a),s.removeChild(a)}a=s.lastChild;if(a&&a.nodeName.toLowerCase()==="div"){while(f=a.firstChild)s.insertBefore(f,a);e.sceditor.ie>=9&&s.insertBefore(r.createElement("br"),a),s.removeChild(a)}}return e(o).remove(),s.innerHTML},i()},e.sceditorBBCodePlugin.bbcodes={b:{tags:{b:null,strong:null},styles:{"font-weight":["bold","bolder","401","700","800","900"]},format:"[b]{0}[/b]",html:"<strong>{0}</strong>"},i:{tags:{i:null,em:null},styles:{"font-style":["italic","oblique"]},format:"[i]{0}[/i]",html:"<em>{0}</em>"},u:{tags:{u:null},styles:{"text-decoration":["underline"]},format:"[u]{0}[/u]",html:"<u>{0}</u>"},s:{tags:{s:null,strike:null},styles:{"text-decoration":["line-through"]},format:"[s]{0}[/s]",html:"<s>{0}</s>"},sub:{tags:{sub:null},format:"[sub]{0}[/sub]",html:"<sub>{0}</sub>"},sup:{tags:{sup:null},format:"[sup]{0}[/sup]",html:"<sup>{0}</sup>"},font:{tags:{font:{face:null}},styles:{"font-family":null},format:function(e,t){return e[0].nodeName.toLowerCase()==="font"&&e.attr("face")?"[font="+this.stripQuotes(e.attr("face"))+"]"+t+"[/font]":"[font="+this.stripQuotes(e.css("font-family"))+"]"+t+"[/font]"},html:function(e,t,n){return'<font face="'+t.defaultattr+'">'+n+"</font>"}},size:{tags:{font:{size:null}},styles:{"font-size":null},format:function(e,t){var n=e.css("fontSize"),r=1;return e.attr("size")?r=e.attr("size"):n.indexOf("px")>-1?(n=n.replace("px","")-0,n>12&&(r=2),n>15&&(r=3),n>17&&(r=4),n>23&&(r=5),n>31&&(r=6),n>47&&(r=7)):r=n,"[size="+r+"]"+t+"[/size]"},html:function(e,t,n){return'<font size="'+t.defaultattr+'">'+n+"</font>"}},color:{tags:{font:{color:null}},styles:{color:null},format:function(e,t){var n=function(e){function n(e){return e=parseInt(e,10),isNaN(e)?"00":(e=Math.max(0,Math.min(e,255)).toString(16),e.length<2?"0"+e:e)}var t;return(t=e.match(/rgb\((\d+),\s*?(\d+),\s*?(\d+)\)/i))?"#"+n(t[1])+n(t[2]-0)+n(t[3]-0):(t=e.match(/#([0-f])([0-f])([0-f])\s*?$/i))?"#"+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]:e},r=e.css("color");return e[0].nodeName.toLowerCase()==="font"&&e.attr("color")&&(r=e.attr("color")),r=n(r),"[color="+r+"]"+t+"[/color]"},html:function(e,t,n){return'<font color="'+t.defaultattr+'">'+n+"</font>"}},ul:{tags:{ul:null},isBlock:!0,format:"[ul]{0}[/ul]",html:"<ul>{0}</ul>"},list:{html:"<ul>{0}</ul>"},ol:{tags:{ol:null},isBlock:!0,format:"[ol]{0}[/ol]",html:"<ol>{0}</ol>"},li:{tags:{li:null},format:"[li]{0}[/li]",html:"<li>{0}</li>"},"*":{html:"<li>{0}</li>"},table:{tags:{table:null},format:"[table]{0}[/table]",html:"<table>{0}</table>"},tr:{tags:{tr:null},format:"[tr]{0}[/tr]",html:"<tr>{0}</tr>"},th:{tags:{th:null},isBlock:!0,format:"[th]{0}[/th]",html:"<th>{0}</th>"},td:{tags:{td:null},isBlock:!0,format:"[td]{0}[/td]",html:'<td>{0}<br class="sceditor-ignore" /></td>'},emoticon:{allowsEmpty:!0,tags:{img:{src:null,"data-sceditor-emoticon":null}},format:function(e,t){return e.attr("data-sceditor-emoticon")+t},html:"{0}"},horizontalrule:{allowsEmpty:!0,tags:{hr:null},format:"[hr]{0}",html:"<hr />"},img:{allowsEmpty:!0,tags:{img:{src:null}},format:function(t,n){var r="",i=function(e){return t.style?t.style.width:null};if(typeof t.attr("data-sceditor-emoticon")!="undefined")return n;if(t.attr("width")||t.attr("height")||i("width")||i("height"))r="="+e(t).width()+"x"+e(t).height();return"[img"+r+"]"+t.attr("src")+"[/img]"},html:function(e,t,n){var r="",i;return typeof t.width!="undefined"&&(r+=' width="'+t.width+'"'),typeof t.height!="undefined"&&(r+=' height="'+t.height+'"'),typeof t.defaultattr!="undefined"&&(i=t.defaultattr.split(/x/i),r=' width="'+i[0]+'"'+' height="'+(i.length===2?i[1]:i[0])+'"'),"<img "+r+' src="'+n+'" />'}},url:{allowsEmpty:!0,tags:{a:{href:null}},format:function(e,t){return e.attr("href").substr(0,7)==="mailto:"?"[email="+e.attr("href").substr(7)+"]"+t+"[/email]":"[url="+decodeURI(e.attr("href"))+"]"+t+"[/url]"},html:function(e,t,n){if(typeof t.defaultattr=="undefined"||t.defaultattr.length===0)t.defaultattr=n;return'<a href="'+encodeURI(t.defaultattr)+'">'+n+"</a>"}},email:{html:function(e,t,n){return typeof t.defaultattr=="undefined"&&(t.defaultattr=n),'<a href="mailto:'+t.defaultattr+'">'+n+"</a>"}},quote:{tags:{blockquote:null},isBlock:!0,format:function(t,n){var r,i="",s=e(t);if(s.children("cite:first").length===1||s.data("author"))r=e(t).children("cite:first").text()||s.data("author"),s.data("author",r),e(t).children("cite:first").remove(),n="",n=this.elementToBbcode(e(t)),i="="+r;return"[quote"+i+"]"+n+"[/quote]"},html:function(e,t,n){return typeof t.defaultattr!="undefined"&&(n="<cite>"+t.defaultattr+"</cite>"+n),"<blockquote>"+n+"</blockquote>"}},code:{tags:{code:null},isBlock:!0,format:"[code]{0}[/code]",html:"<code>{0}</code>"},left:{styles:{"text-align":["left","-webkit-left","-moz-left","-khtml-left"]},isBlock:!0,format:"[left]{0}[/left]",html:'<div align="left">{0}</div>'},center:{styles:{"text-align":["center","-webkit-center","-moz-center","-khtml-center"]},isBlock:!0,format:"[center]{0}[/center]",html:'<div align="center">{0}</div>'},right:{styles:{"text-align":["right","-webkit-right","-moz-right","-khtml-right"]},isBlock:!0,format:"[right]{0}[/right]",html:'<div align="right">{0}</div>'},justify:{styles:{"text-align":["justify","-webkit-justify","-moz-justify","-khtml-justify"]},isBlock:!0,format:"[justify]{0}[/justify]",html:'<div align="justify">{0}</div>'},youtube:{allowsEmpty:!0,tags:{iframe:{"data-youtube-id":null}},format:function(e,t){return e.attr("data-youtube-id")?"[youtube]"+e.attr("data-youtube-id")+"[/youtube]":t},html:'<iframe width="560" height="315" src="http://www.youtube.com/embed/{0}?wmode=opaque" data-youtube-id="{0}" frameborder="0" allowfullscreen></iframe>'},rtl:{styles:{direction:["rtl"]},format:"[rtl]{0}[/rtl]",html:'<div style="direction: rtl">{0}</div>'},ltr:{styles:{direction:["ltr"]},format:"[ltr]{0}[/ltr]",html:'<div style="direction: ltr">{0}</div>'},ignore:{}},e.sceditorBBCodePlugin.bbcode={get:function(t){return e.sceditorBBCodePlugin.bbcodes[t]||null},set:function(t,n){return!t||!n?!1:(n=e.extend(e.sceditorBBCodePlugin.bbcodes[t]||{},n),n.remove=function(){e.sceditorBBCodePlugin.bbcode.remove(t)},e.sceditorBBCodePlugin.bbcodes[t]=n,this)},remove:function(t){return e.sceditorBBCodePlugin.bbcodes[t]&&delete e.sceditorBBCodePlugin.bbcodes[t],this}},e.sceditorBBCodePlugin.commandExists=function(t){return!!e.sceditorBBCodePlugin.bbcode.get(t)},e.sceditorBBCodePlugin.setCommand=function(t,n,r,i,s,o,u){return e.sceditorBBCodePlugin.bbcode.set(t,{tags:n||{},styles:r||{},allowsEmpty:o,isBlock:u,format:i,html:s})},e.fn.sceditorBBCodePlugin=function(t){if((!t||!t.runWithoutWysiwygSupport)&&!e.sceditor.isWysiwygSupported())return;return this.each(function(){new e.sceditorBBCodePlugin(this,t)})}