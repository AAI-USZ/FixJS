function(a){var b,c;return b=function(){function b(a){this.options=a!=null?a:{},this.pendingRequests=JSON.parse(localStorage.getItem("offline-backups")||"[]"),window.addEventListener("online",this.submitPendingRequests)}return b.name="SafetyNet",b.prototype.formKey=function(b){return a(b).attr("id")||a(b).attr("action")},b.prototype.saveProgress=function(b){return localStorage.setItem(c.formKey(this),a(this).serialize())},b.prototype.restoreProgress=function(b){var d,e;e=c.formKey(b);if(d=localStorage.getItem(e))return a(b).deserialize(d),localStorage.removeItem(e)},b.prototype.submitForm=function(b){var d,e,f;return navigator.onLine?localStorage.removeItem(c.formKey(this)):(e=a(this).find("input[name=_method]").val()||a(this).attr("method")||"get",d=""+a(this).attr("action")+":"+e+":"+(new Date).getTime(),f=a(this).serialize(),c.addPendingRequest(d,f),c.options.failure&&c.options.failure(this),b.preventDefault())},b.prototype.addPendingRequest=function(a,b){return localStorage.setItem(a,b),c.pendingRequests.push(a),localStorage.setItem("offline-backups",JSON.stringify(c.pendingRequests))},b.prototype.submitPendingRequests=function(){var b,d,e,f,g,h=this;if(f=c.pendingRequests[0])return d=localStorage.getItem(f),g=f.split(":"),b=g[0],e=g[1],a.ajax({type:e,url:b,data:d,success:function(){return c.pendingRequests.shift(),localStorage.setItem("offline-backups",JSON.stringify(c.pendingRequests)),localStorage.removeItem(f),c.submitPendingRequests()}});if(c.options.success)return c.options.success()},b}(),c=null,a.fn.safetyNet=function(d){if(typeof Storage!="undefined"){c=new b(d),a(this.selector).on("submit",c.submitForm);if(d.progressive)return a(this.selector).on("change",c.saveProgress),this.each(function(){return c.restoreProgress(this)})}}}