function(){if(Modernizr.localstorage){var a=Backbone.sync;Backbone.sync=function(b,c,d){switch(b){case"create":case"update":case"delete":a.apply(this,arguments);break;case"read":if(typeof this.localStorage=="object"){var e=this.localStorage.id?this.localStorage.id:c.id;var f=window.localStorage.getItem(e+":timestamp");if(e){if(d.forceRefresh||!f||this.localStorage.maxRefresh&&(new Date).getTime()-f>this.localStorage.maxRefresh){var g=d.success;d.success=function(a,b,c){try{localStorage.setItem(e,JSON.stringify(a));localStorage.setItem(e+":timestamp",(new Date).getTime())}catch(d){if(d==QUOTA_EXCEEDED_ERR){localStorage.clear()}}if(g){g.apply(this,arguments)}};a.apply(this,[b,c,d])}else{var h=localStorage.getItem(e);setTimeout(function(){d.success(JSON.parse(h),"success",null)},0)}}else{a.apply(this,arguments)}}else{a.apply(this,arguments)}break}}}else{console.warn("Local Storage is not supported!")}window.BackboneLocalStorage={setVersion:function(a){if(Modernizr.localstorage){var b=localStorage.getItem("localstorage:version");if(b&&b.toString()!=a){localStorage.clear();console.log("Local Storage is cleared since a different version is detected (from "+b+" to "+a+")!")}localStorage.setItem("localstorage:version",a.toString())}}}}