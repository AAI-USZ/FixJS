function(){new a.sceditor(this,b)})}})(jQuery,window,document),function(a){"use strict",a.sceditorBBCodePlugin=function(b,c){var d=this,e,f,g,h,i,j,k,l,m;d.bbcodes=a.sceditorBBCodePlugin.bbcodes;var n={},o={},p={ul:["li"],ol:["li"],table:["tr"],tr:["td","th"],code:["br","p","div"],youtube:[]};e=function(){a.data(b,"sceditorbbcode",d),d.options=a.extend({},a.sceditor.defaultOptions,c),f(),new a.sceditor(b,a.extend({},d.options,{getHtmlHandler:d.getHtmlHandler,getTextHandler:d.getTextHandler,commands:m()}))},m=function(){var b={bold:{txtExec:["[b]","[/b]"]},italic:{txtExec:["[i]","[/i]"]},underline:{txtExec:["[u]","[/u]"]},strike:{txtExec:["[s]","[/s]"]},subscript:{txtExec:["[sub]","[/sub]"]},superscript:{txtExec:["[sup]","[/sup]"]},left:{txtExec:["[left]","[/left]"]},center:{txtExec:["[center]","[/center]"]},right:{txtExec:["[right]","[/right]"]},justify:{txtExec:["[justify]","[/justify]"]},font:{txtExec:function(b){var c=this;a.sceditor.command.get("font")._createDropDown(c,b,function(a){c.insertText("[font="+a+"]","[/font]")})}},size:{txtExec:function(b){var c=this;a.sceditor.command.get("size")._createDropDown(c,b,function(a){c.insertText("[size="+a+"]","[/size]")})}},color:{txtExec:function(b){var c=this;a.sceditor.command.get("color")._createDropDown(c,b,function(a){c.insertText("[color="+a+"]","[/color]")})}},bulletlist:{txtExec:["[ul][li]","[/li][/ul]"]},orderedlist:{txtExec:["[ol][li]","[/li][/ol]"]},table:{txtExec:["[table][tr][td]","[/td][/tr][/table]"]},horizontalrule:{txtExec:["[hr]"]},code:{txtExec:["[code]","[/code]"]},image:{txtExec:function(a,b){var c=prompt(this._("Enter the image URL:"),b);c&&this.insertText("[img]"+c+"[/img]")}},email:{txtExec:function(a,b){var c=prompt(this._("Enter the e-mail address:"),b||"@"),d=prompt(this._("Enter the displayed text:"),c)||c;c&&this.insertText("[email="+c+"]"+d+"[/email]")}},link:{txtExec:function(a,b){var c=prompt(this._("Enter URL:"),b||"http://"),d=prompt(this._("Enter the displayed text:"),c)||c;c&&this.insertText("[url="+c+"]"+d+"[/url]")}},quote:{txtExec:["[quote]","[/quote]"]},youtube:{txtExec:function(a,b){var c=prompt(this._("Enter the YouTube video URL or ID:"),b);c&&(c.indexOf("://")>-1&&(c=c.replace(/^[^v]+v.(.{11}).*/,"$1")),this.insertText("[youtube]"+c+"[/youtube]"))}},rtl:{txtExec:["[rtl]","[/rtl]"]},ltr:{txtExec:["[ltr]","[/ltr]"]}};return a.extend(!0,{},b,a.sceditor.commands)},f=function(){a.each(d.bbcodes,function(b,c){typeof d.bbcodes[b].tags!="undefined"&&a.each(d.bbcodes[b].tags,function(a,c){var e=!!d.bbcodes[b].isBlock;n[a]=n[a]||{},n[a][e]=n[a][e]||{},n[a][e][b]=c}),typeof d.bbcodes[b].styles!="undefined"&&a.each(d.bbcodes[b].styles,function(a,c){var e=!!d.bbcodes[b].isBlock;o[e]=o[e]||{},o[e][a]=o[e][a]||{},o[e][a][b]=c})})},j=function(b,c){var d=a.camelCase(c),e,f,g;return"text-align"===c?(e=a(b),e.parent().css(c)!==e.css(c)&&e.css("display")==="block"&&!e.is("hr")&&!e.is("th")&&(f=e.css(c)),g=b.style.direction,g&&(/right/i.test(f)&&g==="rtl"||/left/i.test(f)&&g==="ltr")?null:f):b.style?b.style[d]:null},l=function(a){var b=a.childNodes,c=b.length;if(a.nodeValue)return!1;if(b.length===0||b.length===1&&(/br/i.test(b[0].nodeName)||l(b[0])))return!0;while(c--)if(!l(b[c]))return!1;return!0},g=function(b,c,e){var f,g=b[0].nodeName.toLowerCase();return e=!!e,o[e]?(a.each(o[e],function(e,g){f=j(b[0],e);if(!f||j(b.parent()[0],e)===f)return;a.each(g,function(e,g){if(!c&&!d.bbcodes[e].allowsEmpty&&l(b[0]))return;if(!g||a.inArray(f.toString(),g)>-1)a.isFunction(d.bbcodes[e].format)?c=d.bbcodes[e].format.call(d,b,c):c=i(d.bbcodes[e].format,c)})}),c):c},h=function(b,c,e){var f=b[0].nodeName.toLowerCase();e=!!e,n[f]&&n[f][e]&&a.each(n[f][e],function(e,f){if(!c&&!d.bbcodes[e].allowsEmpty&&l(b[0]))return;if(f){var g=!1;a.each(f,function(c,d){if(!b.attr(c)||d&&a.inArray(b.attr(c),d)<0)return;return g=!0,!1});if(!g)return}a.isFunction(d.bbcodes[e].format)?c=d.bbcodes[e].format.call(d,b,c):c=i(d.bbcodes[e].format,c)});if(e&&/^(br|div|p)$/.test(f)){var g=b[0].parentNode.childNodes;("br"!==f||g.length!==1)&&("br"!==f||g[g.length-1]!==b[0])&&(c+="\n"),"br"!==f&&!a.sceditor.dom.isInline(b.parent()[0])&&b[0].previousSibling&&b[0].previousSibling.nodeType===3&&(c="\n"+c)}return c},i=function(){var a=arguments;return a[0].replace(/\{(\d+)\}/g,function(b,c){return typeof a[c-0+1]!="undefined"?a[c-0+1]:"{"+c+"}"})},d.stripQuotes=function(a){return a.replace(/^(["'])(.*?)\1$/,"$2")},d.getHtmlHandler=function(b,c){return a.sceditor.dom.removeWhiteSpace(c[0]),a.trim(d.elementToBbcode(c))},d.elementToBbcode=function(b){return function c(b,d){var e="";return a.sceditor.dom.traverse(b,function(b){var f=a(b),i="",j=b.nodeName.toLowerCase(),k=p[j],l=!0;typeof d=="object"&&(l=a.inArray(j,d)>-1,l||(k=d));if(b.nodeType!==3){if(f.hasClass("sceditor-ignore"))return;j!=="iframe"&&(i=c(b,k)),l?(f.is("code")||(i=g(f,i),i=h(f,i),i=g(f,i,!0)),e+=h(f,i,!0)):e+=i}else b.wholeText&&(!b.previousSibling||b.previousSibling.nodeType!==3)?a(b).parents("code").length===0?e+=b.wholeText.replace(/ +/g," "):e+=b.wholeText:b.wholeText||(e+=b.nodeValue)},!1,!0),e}(b.get(0))},d.getTextHandler=function(b,c){var e,f,g=/\[([^\[\s=]+)(?:([^\[\]]+))?\]((?:[\s\S](?!\[\1))*?)\[\/(\1)\]/g,h=/(\S+)=((?:(?:(["'])(?:\\\3|[^\3])*?\3))|(?:[^'"\s]+))/g;f=function(b,c,e,f){var g={},j;c=c.toLowerCase();if(e){e=a.trim(e);if(e.charAt(0)==="="&&e.split("=").length-1<=1||c==="url")g.defaultattr=d.stripQuotes(e.substr(1));else{e.charAt(0)==="="&&(e="defaultattr"+e);while(j=h.exec(e))g[j[1].toLowerCase()]=d.stripQuotes(j[2])}}return d.bbcodes[c]?a.isFunction(d.bbcodes[c].html)?d.bbcodes[c].html.call(d,c,g,f):i(d.bbcodes[c].html,f):b},b=b.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r/g,"").replace(/(\[\/?(?:left|center|right|justify|align|rtl|ltr)\])\n/g,"$1").replace(/\n/g,"<br />");while(b!==e)e=b,b=b.replace(g,f);return b=b.replace(/\[hr\]/gi,"<hr>").replace(/\[\*\]/gi,"<li>"),b=b.replace(/ {2}(?=([^<\>]*?<|[^<\>]*?$))/g," &nbsp;"),k(b,c)},k=function(b,c){var d=document,e=d.createDocumentFragment(),f=d.createElement("div"),g=d.createElement("div"),h,i,j,k;a(g).hide().appendTo(d.body),g.innerHTML=b,i=g.firstChild;while(i){j=i.nextSibling,k=i.nodeName.toLowerCase();if(i.nodeType===1&&!a.sceditor.dom.isInline(i)||k==="br"){if(e.childNodes.length>0||k==="br")h=d.createElement("div"),h.appendChild(e),k==="br"&&(!a.sceditor.ie||a.sceditor.ie<9)&&h.appendChild(d.createElement("br")),f.appendChild(h),e=d.createDocumentFragment();k!=="br"&&f.appendChild(i)}else e.appendChild(i);i=j}e.childNodes.length>0&&(h=d.createElement("div"),h.appendChild(e),f.appendChild(h));if(c){i=f.firstChild;if(i&&i.nodeName.toLowerCase()==="div"){while(j=i.firstChild)f.insertBefore(j,i);a.sceditor.ie>=9&&f.insertBefore(d.createElement("br"),i),f.removeChild(i)}i=f.lastChild;if(i&&i.nodeName.toLowerCase()==="div"){while(j=i.firstChild)f.insertBefore(j,i);a.sceditor.ie>=9&&f.insertBefore(d.createElement("br"),i),f.removeChild(i)}}return a(g).remove(),f.innerHTML},e()},a.sceditorBBCodePlugin.bbcodes={b:{tags:{b:null,strong:null},styles:{"font-weight":["bold","bolder","401","700","800","900"]},format:"[b]{0}[/b]",html:"<strong>{0}</strong>"},i:{tags:{i:null,em:null},styles:{"font-style":["italic","oblique"]},format:"[i]{0}[/i]",html:"<em>{0}</em>"},u:{tags:{u:null},styles:{"text-decoration":["underline"]},format:"[u]{0}[/u]",html:"<u>{0}</u>"},s:{tags:{s:null,strike:null},styles:{"text-decoration":["line-through"]},format:"[s]{0}[/s]",html:"<s>{0}</s>"},sub:{tags:{sub:null},format:"[sub]{0}[/sub]",html:"<sub>{0}</sub>"},sup:{tags:{sup:null},format:"[sup]{0}[/sup]",html:"<sup>{0}</sup>"},font:{tags:{font:{face:null}},styles:{"font-family":null},format:function(a,b){return a[0].nodeName.toLowerCase()==="font"&&a.attr("face")?"[font="+this.stripQuotes(a.attr("face"))+"]"+b+"[/font]":"[font="+this.stripQuotes(a.css("font-family"))+"]"+b+"[/font]"},html:function(a,b,c){return'<font face="'+b.defaultattr+'">'+c+"</font>"}},size:{tags:{font:{size:null}},styles:{"font-size":null},format:function(a,b){var c=a.css("fontSize"),d=1;return c.indexOf("px")>-1?(c=c.replace("px","")-0,c>12&&(d=2),c>15&&(d=3),c>17&&(d=4),c>23&&(d=5),c>31&&(d=6),c>47&&(d=7)):d=c,"[size="+d+"]"+b+"[/size]"},html:function(a,b,c){return'<font size="'+b.defaultattr+'">'+c+"</font>"}},color:{tags:{font:{color:null}},styles:{color:null},format:function(a,b){var c=function(a){function c(a){return a=parseInt(a,10),isNaN(a)?"00":(a=Math.max(0,Math.min(a,255)).toString(16),a.length<2?"0"+a:a)}var b;return(b=a.match(/rgb\((\d+),\s*?(\d+),\s*?(\d+)\)/i))?"#"+c(b[1])+c(b[2]-0)+c(b[3]-0):(b=a.match(/#([0-f])([0-f])([0-f])\s*?$/i))?"#"+b[1]+b[1]+b[2]+b[2]+b[3]+b[3]:a},d=a.css("color");return a[0].nodeName.toLowerCase()==="font"&&a.attr("color")&&(d=a.attr("color")),d=c(d),"[color="+d+"]"+b+"[/color]"},html:function(a,b,c){return'<font color="'+b.defaultattr+'">'+c+"</font>"}},ul:{tags:{ul:null},isBlock:!0,format:"[ul]{0}[/ul]",html:"<ul>{0}</ul>"},list:{html:"<ul>{0}</ul>"},ol:{tags:{ol:null},isBlock:!0,format:"[ol]{0}[/ol]",html:"<ol>{0}</ol>"},li:{tags:{li:null},format:"[li]{0}[/li]",html:"<li>{0}</li>"},"*":{html:"<li>{0}</li>"},table:{tags:{table:null},format:"[table]{0}[/table]",html:"<table>{0}</table>"},tr:{tags:{tr:null},format:"[tr]{0}[/tr]",html:"<tr>{0}</tr>"},th:{tags:{th:null},isBlock:!0,format:"[th]{0}[/th]",html:"<th>{0}</th>"},td:{tags:{td:null},isBlock:!0,format:"[td]{0}[/td]",html:'<td>{0}<br class="sceditor-ignore" /></td>'},emoticon:{allowsEmpty:!0,tags:{img:{src:null,"data-sceditor-emoticon":null}},format:function(a,b){return a.attr("data-sceditor-emoticon")+b},html:"{0}"},horizontalrule:{allowsEmpty:!0,tags:{hr:null},format:"[hr]{0}",html:"<hr />"},img:{allowsEmpty:!0,tags:{img:{src:null}},format:function(b,c){var d="",e=function(a){return b.style?b.style.width:null};if(typeof b.attr("data-sceditor-emoticon")!="undefined")return c;if(b.attr("width")||b.attr("height")||e("width")||e("height"))d="="+a(b).width()+"x"+a(b).height();return"[img"+d+"]"+b.attr("src")+"[/img]"},html:function(a,b,c){var d="",e;return typeof b.width!="undefined"&&(d+=' width="'+b.width+'"'),typeof b.height!="undefined"&&(d+=' height="'+b.height+'"'),typeof b.defaultattr!="undefined"&&(e=b.defaultattr.split(/x/i),d=' width="'+e[0]+'"'+' height="'+(e.length===2?e[1]:e[0])+'"'),"<img "+d+' src="'+c+'" />'}},url:{allowsEmpty:!0,tags:{a:{href:null}},format:function(a,b){return a.attr("href").substr(0,7)==="mailto:"?"[email="+a.attr("href").substr(7)+"]"+b+"[/email]":"[url="+decodeURI(a.attr("href"))+"]"+b+"[/url]"},html:function(a,b,c){if(typeof b.defaultattr=="undefined"||b.defaultattr.length===0)b.defaultattr=c;return'<a href="'+encodeURI(b.defaultattr)+'">'+c+"</a>"}},email:{html:function(a,b,c){return typeof b.defaultattr=="undefined"&&(b.defaultattr=c),'<a href="mailto:'+b.defaultattr+'">'+c+"</a>"}},quote:{tags:{blockquote:null},isBlock:!0,format:function(b,c){var d,e="",f=a(b);if(f.children("cite:first").length===1||f.data("author"))d=a(b).children("cite:first").text()||f.data("author"),f.data("author",d),a(b).children("cite:first").remove(),c="",c=this.elementToBbcode(a(b)),e="="+d;return"[quote"+e+"]"+c+"[/quote]"},html:function(a,b,c){return typeof b.defaultattr!="undefined"&&(c="<cite>"+b.defaultattr+"</cite>"+c),"<blockquote>"+c+"</blockquote>"}},code:{tags:{code:null},isBlock:!0,format:"[code]{0}[/code]",html:"<code>{0}</code>"},left:{styles:{"text-align":["left","-webkit-left","-moz-left","-khtml-left"]},isBlock:!0,format:"[left]{0}[/left]",html:'<div align="left">{0}</div>'},center:{styles:{"text-align":["center","-webkit-center","-moz-center","-khtml-center"]},isBlock:!0,format:"[center]{0}[/center]",html:'<div align="center">{0}</div>'},right:{styles:{"text-align":["right","-webkit-right","-moz-right","-khtml-right"]},isBlock:!0,format:"[right]{0}[/right]",html:'<div align="right">{0}</div>'},justify:{styles:{"text-align":["justify","-webkit-justify","-moz-justify","-khtml-justify"]},isBlock:!0,format:"[justify]{0}[/justify]",html:'<div align="justify">{0}</div>'},youtube:{allowsEmpty:!0,tags:{iframe:{"data-youtube-id":null}},format:function(a,b){return a.attr("data-youtube-id")?"[youtube]"+a.attr("data-youtube-id")+"[/youtube]":b},html:'<iframe width="560" height="315" src="http://www.youtube.com/embed/{0}?wmode=opaque" data-youtube-id="{0}" frameborder="0" allowfullscreen></iframe>'},rtl:{styles:{direction:["rtl"]},format:"[rtl]{0}[/rtl]",html:'<div style="direction: rtl">{0}</div>'},ltr:{styles:{direction:["ltr"]},format:"[ltr]{0}[/ltr]",html:'<div style="direction: ltr">{0}</div>'},ignore:{}},a.sceditorBBCodePlugin.bbcode={get:function(b){return a.sceditorBBCodePlugin.bbcodes[b]||null},set:function(b,c){return!b||!c?!1:(c=a.extend(a.sceditorBBCodePlugin.bbcodes[b]||{},c),c.remove=function(){a.sceditorBBCodePlugin.bbcode.remove(b)},a.sceditorBBCodePlugin.bbcodes[b]=c,this)},remove:function(b){return a.sceditorBBCodePlugin.bbcodes[b]&&delete a.sceditorBBCodePlugin.bbcodes[b],this}},a.sceditorBBCodePlugin.commandExists=function(b){return!!a.sceditorBBCodePlugin.bbcode.get(b)},a.sceditorBBCodePlugin.setCommand=function(b,c,d,e,f,g,h){return a.sceditorBBCodePlugin.bbcode.set(b,{tags:c||{},styles:d||{},allowsEmpty:g,isBlock:h,format:e,html:f})},a.fn.sceditorBBCodePlugin=function(b){if((!b||!b.runWithoutWysiwygSupport)&&!a.sceditor.isWysiwygSupported())return;return this.each(function(){new a.sceditorBBCodePlugin(this,b)}