function(b){var g=40,f=13,d=27,i=9,e=38,h=39,c="down:39+shift",a=function(j){a.superclass.constructor.apply(this,arguments);};a.NAME="Navigation";a.ATTRS={activeRegistryIndex:{value:null},registry:[]};b.extend(a,b.Base,{container:{containerId:null,children:[],childIndexInFocus:-1},initializer:function(j){var k=this;b.one("body").on("key",function(l){k.makeNextContainerNavigable();},c);this.makeNextContainerNavigable();},makeNextContainerNavigable:function(){var j=this.get("registry");if(j.length>0){var k=this.getNextRegistryIndex();if(k!==null&&j[k]){var l=b.one(j[k].node);this.deactivateRegisteredContainer();this.registerContainer(l);this.initiateNavigation();}}},getNextRegistryIndex:function(){var j=this.get("registry"),k,l;if(j&&j.length>0){k=j.length;l=this.get("activeRegistryIndex");if(l===null){l=0;}else{l++;if(l>=k){l=0;}}this.set("activeRegistryIndex",l);return l;}return null;},registerContainer:function(j){if(j){this.updateChildren(j);}},updateChildren:function(l){var k=l.all("> *");var j=[];k.each(function(o,m,n){j[m]=o;});this.container.children=j;this.container.containerId=l.generateID();},initiateNavigation:function(){this.activateRegisteredContainer();},deactivateRegisteredContainer:function(){this.killAllSubscription();this.removeHighlightonCurrentChild();this.resetContainer();},removeHighlightonCurrentChild:function(){var j=this.container;var k=j.childIndexInFocus;if(k!==null&&k!==-1){j.children[k].removeClass("highlight");}},resetRegistryIndex:function(){this.set("activeRegistryIndex",null);},resetContainer:function(){this.container={containerId:null,children:[],childIndexInFocus:-1};this.wasLastChild=false;},killAllSubscription:function(){if(b.BodySubscr){this.detachAllSubscriptions();}},activateRegisteredContainer:function(){b.BodySubscr={};b.BodySubscr.keydown=b.one("body").on("down",b.bind(this.onMyKeyDown,this));b.BodySubscr.keyup=b.one("body").on("up",b.bind(this.onMyKeyUp,this));},detachAllSubscriptions:function(){for(var j in b.BodySubscr){b.BodySubscr[j].detach();}delete b.BodySubscr;},onMyKeyDown:function(k){this.wasLastChild=false;if(this.container){k.preventDefault();var j=this.container,m=j.childIndexInFocus,l=this.getNextIndex(m);j.childIndexInFocus=l;this.bringChildtoFocus(j.children[l]);}},onMyKeyUp:function(k){if(this.container){k.preventDefault();var j=this.container,m=j.childIndexInFocus,l=this.getPreviousIndex(m);this.bringChildtoFocus(j.children[l]);j.childIndexInFocus=l;}},destructor:function(){delete this.anim;},animateScroll:function(j){this.anim=new b.Anim({node:"window",from:{scroll:[b.DOM.docScrollX(),b.DOM.docScrollY()]},to:{scroll:[b.DOM.docScrollX(),j]},duration:0.1,easing:b.Easing.easeNone}).run();},getNextIndex:function(l){var j=this.container,k=j.children.length;if(l!=-1){j.children[l].removeClass("highlight");}if(l===k-1){l=-1;this.wasLastChild=true;}else{this.wasLastChild=false;}l++;return l;},getPreviousIndex:function(l){var j=this.container,k=j.children.length;if(l>=0){j.children[l].removeClass("highlight");}if(l===0){l=k;}l--;if(l<0){l=0;}return l;},scrollToCenter:function(l){var n=l.getY(),j=l.get("clientHeight"),o=j/2,k=l.get("winHeight");if(j>k){o=0;}var m=k/2;if(n>m){if(this.anim&&this.anim.get("running")){this.anim.pause();}return n-m+o;}},bringChildtoFocus:function(k){k.addClass("highlight").focus();if(this.anim&&this.anim.get("running")){this.anim.pause();}if(this.wasLastChild){k.scrollIntoView();}if(this.container.childIndexInFocus===0){k.scrollIntoView();}var j=this.scrollToCenter(k);this.animateScroll(j);}});b.Nav=a;},"@VERSION@",{requires:["node","event","event-key","gallery-event-nav-keys","base","anim"],skinnable:false}